(function(f,b,c){var d=Rho;var a=(function(){(function(l){var p=this.Opal={};function r(){}function z(){}function v(){}function u(){}var x=function(){};x.prototype=p;p.alloc=x;p.global=this;var n=p.hasOwnProperty;var t=p.slice=Array.prototype.slice;var i=0;p.cvars={};p.gvars={};p.klass=function(F,D,I,E){var B;if(F._isObject){F=F._klass}if(D===null){D=z}if(n.call(F._scope,I)){B=F._scope[I]}else{if(!D._methods){var G=D;D=z;B=w(G)}else{B=g(D,E)}B._name=(F===z?I:F._name+"::"+I);var H=function(){};var C=H.prototype=new F._scope.alloc();B._scope=C;C.alloc=H;F[I]=F._scope[I]=B;if(D.$inherited){D.$inherited(B)}}return B};p.module=function(E,G,D){var B;if(E._isObject){E=E._klass}if(n.call(E._scope,G)){B=E._scope[G]}else{B=g(v,D);B._name=(E===z?G:E._name+"::"+G);B.$included_in=[];var F=function(){};var C=F.prototype=new E._scope.alloc();B._scope=C;C.alloc=F;E[G]=E._scope[G]=B}return B};var y=function(){throw new Error("no block given")};var k=function(F,D,C){if(C){var E=function(){};E.prototype=C.prototype;D.prototype=new E()}var B=D.prototype;B.constructor=D;B._isObject=true;B._klass=D;D._included_in=[];D._isClass=true;D._name=F;D._super=C;D._methods=[];D._smethods=[];D._isObject=false;D._donate=A;D._sdonate=j;p[F]=D;return D};var g=function(E,G){var I=function(){};I.prototype=E.prototype;G.prototype=new I();var D=G.prototype;D._klass=G;D.constructor=G;G._included_in=[];G._isClass=true;G._super=E;G._methods=[];G._isObject=false;G._klass=v;G._donate=A;G._sdonate=j;G["$==="]=s;G.$to_s=o;var C;C=E._smethods.slice();G._smethods=C;for(var F=0,H=C.length;F<H;F++){var B=C[F];G[B]=E[B]}return G};var w=function(F){F.prototype._klass=F;F._included_in=[];F._isClass=true;F._super=z;F._klass=v;F._methods=[];F._smethods=[];F._isObject=false;F._donate=function(){};F._sdonate=j;F["$==="]=s;F.$to_s=o;var D=F._smethods=v._methods.slice();for(var E=0,H=D.length;E<H;E++){var B=D[E];F[B]=z[B]}m.push(F);var G=z.prototype,C=z._methods;for(var E=0,H=C.length;E<H;E++){var B=C[E];F.prototype[B]=G[B]}F._smethods.push("$allocate");return F};p.puts=function(B){console.log(B)};k("BasicObject",r);k("Object",z,r);k("Class",v,z);v.prototype=Function.prototype;r._klass=z._klass=v._klass=v;function s(B){if(B==null){return false}var C=B._klass;while(C){if(C===this){return true}C=C._super}return false}function o(){return this._name}function A(F,D){var E=this._methods,L=this.$included_in;this._methods=E.concat(F);if(L){for(var H=0,C=L.length;H<C;H++){var J=L[H];var K=J.prototype;for(var G=0,I=F.length;G<I;G++){var B=F[G];K[B]=this.prototype[B]}if(J.$included_in){J._donate(F,true)}}}}function j(B){this._smethods=this._smethods.concat(B)}var m=z.$included_in=[];r._scope=z._scope=p;p.Module=p.Class;p.Kernel=z;var q=function(){};var h=new x();h.alloc=q;v._scope=h;z.prototype.toString=function(){return this.$to_s()};p.top=new z;p.klass(z,z,"NilClass",u);p.nil=new u;p.breaker=new Error("unexpected break");p.version="0.3.33";(function(){var B=p,D=B.top,E=B,C=B.nil,G=D._klass.prototype,F=B.breaker,H=B.slice,I=B.gvars;I["~"]=C;I["/"]="\n";E.RUBY_ENGINE="opal";E.RUBY_PLATFORM="opal";E.RUBY_VERSION="1.9.2";E.OPAL_VERSION=B.version;D.$to_s=function(){return"main"};return D.$include=function(J){return E.Object.$include(J)}})();(function(){var B=p,D=B.top,E=B,C=B.nil,F=B.breaker,G=B.slice,H=B.klass;return(function(I,M){function J(){}J=H(I,M,"Class",J);J._sdonate(["$new"]);var L=J.prototype,K=J._scope;J.$new=function(P,S){var Q=arguments.length-1;if(typeof(arguments[Q])==="function"&&arguments[Q]._s!==l){S=arguments[Q]}else{S=C}if(P==null||P===S){P=K.Object}function O(){}var N=g(P,O);N._name=C;P.$inherited(N);if(S!==C){var R=S._s;S._s=null;S.call(N);S._s=R}return N};L.$allocate=function(){var N=new this;N._id=i++;return N};L.$alias_method=function(N,O){this.prototype["$"+N]=this.prototype["$"+O];return this};L.$ancestors=function(){var O=this,N=[];while(O){N.push(O);O=O._super}return N};L.$append_features=function(S){var P=this;if(!S.$included_modules){S.$included_modules=[]}for(var U=0,O=S.$included_modules.length;U<O;U++){if(S.$included_modules[U]===P){return}}S.$included_modules.push(P);if(!P.$included_in){P.$included_in=[]}P.$included_in.push(S);var V=P.prototype,T=S.prototype,Q=P._methods;for(var R=0,O=Q.length;R<O;R++){var N=Q[R];T[N]=V[N]}if(T._smethods){T._sdonate(Q)}if(S.$included_in){S._donate(Q.slice(),true)}return this};L.$attr_accessor=function(N){N=G.call(arguments,0);this.$attr_reader.apply(this,[].concat(N));return this.$attr_writer.apply(this,[].concat(N))};L.$attr_reader=function(Q){Q=G.call(arguments,0);var P=this.prototype;for(var N=0,O=Q.length;N<O;N++){(function(R){P[R]=C;P["$"+R]=function(){return this[R]}})(Q[N])}return C};L.$attr_writer=function(Q){Q=G.call(arguments,0);var P=this.prototype;for(var N=0,O=Q.length;N<O;N++){(function(R){P[R]=C;P["$"+R+"="]=function(S){return this[R]=S}})(Q[N])}return C};L.$attr=L.$attr_accessor;L.$define_method=function(O,P){if(typeof(P)!=="function"){P=C}if(P===C){y()}var N="$"+O;P._jsid=N;P._sup=this.prototype[N];P._s=null;this.prototype[N]=P;this._donate([N]);return C};L.$include=function(P){P=G.call(arguments,0);var O=P.length-1,N;while(O>=0){N=P[O];O--;if(N===this){continue}(N).$append_features(this);(N).$included(this)}return this};L.$instance_methods=function(O){if(O==null){O=false}var N=[],P=this.prototype;for(var Q in this.prototype){if(!O&&!P.hasOwnProperty(Q)){continue}if(Q.charAt(0)==="$"){N.push(Q.substr(1))}}return N};L.$included=function(N){return C};L.$inherited=function(N){return C};L.$module_eval=function(P){if(typeof(P)!=="function"){P=C}if(P===C){y()}var O=P._s,N;P._s=null;N=P.call(this);P._s=O;return N};L.$class_eval=L.$module_eval;L.$name=function(){return this._name};L.$new=function(){var N=G.call(arguments);var O=new this;O._id=i++;O.$initialize.apply(O,N);return O};L.$public=function(){return C};L.$private=L.$public;L.$protected=L.$public;L.$superclass=function(){return this._super||C};return C})(D,null)})();(function(){var B=p,D=B.top,E=B,C=B.nil,F=B.breaker,G=B.slice,H=B.klass;return(function(J,M){function I(){}I=H(J,M,"BasicObject",I);var L=I.prototype,K=I._scope;L.$initialize=function(){return C};L["$=="]=function(N){return this===N};L.$__send__=function(O,N,P){var P;N=G.call(arguments,1);if(typeof(N[N.length-1])==="function"){P=N.pop()}else{P=C}return this["$"+O].apply(this,N)};L["$eql?"]=L["$=="];L["$equal?"]=L["$=="];L.$instance_eval=function(P){if(typeof(P)!=="function"){P=C}if(P===C){y()}var O=P._s,N;P._s=null;N=P.call(this,this);P._s=O;return N};L.$instance_exec=function(O,Q){var Q;O=G.call(arguments,0);if(typeof(O[O.length-1])==="function"){Q=O.pop()}else{Q=C}if(Q===C){y()}var P=Q._s,N;Q._s=null;N=Q.apply(this,O);Q._s=P;return N};return C})(D,null)})();(function(){var B=p,D=B.top,E=B,C=B.nil,G=B.breaker,H=B.slice,F=B.module;return(function(I){function L(){}L=F(I,"Kernel",L);var K=L.prototype,J=L._scope;K.$initialize=K.$initialize;K["$=="]=K["$=="];K.$__send__=K.$__send__;K["$eql?"]=K["$eql?"];K["$equal?"]=K["$equal?"];K.$instance_eval=K.$instance_eval;K.$instance_exec=K.$instance_exec;K["$=~"]=function(M){return false};K["$==="]=function(M){return this==M};K.$method=function(N){var O=this,M=O["$"+N],P=function(){return M.apply(O,H.call(arguments,0))};if(!M){this.$raise(J.NameError)}P._klass=J.Method;return P};K.$methods=function(O){if(O==null){O=true}var N=[];for(var M in this){if(M[0]=="$"&&typeof(this)[M]==="function"){if(O===false||O===C){if(!z.hasOwnProperty.call(this,M)){continue}}N.push(M.substr(1))}}return N};K.$Array=function(M){if(M.$to_ary){return M.$to_ary()}else{if(M.$to_a){return M.$to_a()}}return[M]};K.$class=function(){return this._klass};K.$define_singleton_method=function(O,M){if(typeof(M)!=="function"){M=C}if(M===C){y()}var N="$"+O;M._jsid=N;M._sup=this[N];M._s=null;this[N]=M;return this};K["$equal?"]=function(M){return this===M};K.$extend=function(O){O=H.call(arguments,0);for(var M=0,N=O.length;M<N;M++){this.$singleton_class().$include(O[M])}return this};K.$format=function(O,N){N=H.call(arguments,1);var M=0;return O.replace(/%(\d+\$)?([-+ 0]*)(\d*|\*(\d+\$)?)(?:\.(\d*|\*(\d+\$)?))?([cspdiubBoxXfgeEG])|(%%)/g,function(aa,ag,S,W,ai,af,Q,U,T){if(T){return"%"}var Z,P,ac=("diubBoxX".indexOf(U)!=-1),ad=("eEfgG".indexOf(U)!=-1),ab="",X;if(W===l){Z=l}else{if(W.charAt(0)=="*"){var R=M++;if(ai){R=parseInt(ai,10)-1}Z=(N[R]).$to_i()}else{Z=parseInt(W,10)}}if(af===l){P=ad?6:l}else{if(af.charAt(0)=="*"){var ae=M++;if(Q){ae=parseInt(Q,10)-1}P=(N[ae]).$to_i()}else{P=parseInt(af,10)}}if(ag){M=parseInt(ag,10)-1}switch(U){case"c":X=N[M];if(X._isString){aa=X.charAt(0)}else{aa=String.fromCharCode((X).$to_i())}break;case"s":aa=(N[M]).$to_s();if(P!==l){aa=aa.substr(0,P)}break;case"p":aa=(N[M]).$inspect();if(P!==l){aa=aa.substr(0,P)}break;case"d":case"i":case"u":aa=(N[M]).$to_i().toString();break;case"b":case"B":aa=(N[M]).$to_i().toString(2);break;case"o":aa=(N[M]).$to_i().toString(8);break;case"x":case"X":aa=(N[M]).$to_i().toString(16);break;case"e":case"E":aa=(N[M]).$to_f().toExponential(P);break;case"f":aa=(N[M]).$to_f().toFixed(P);break;case"g":case"G":aa=(N[M]).$to_f().toPrecision(P);break}M++;if(ac||ad){if(aa.charAt(0)=="-"){ab="-";aa=aa.substr(1)}else{if(S.indexOf("+")!=-1){ab="+"}else{if(S.indexOf(" ")!=-1){ab=" "}}}}if(ac&&P!==l){if(aa.length<P){aa="0"["$*"](P-aa.length)+aa}}var Y=ab.length+aa.length;if(Z!==l&&Y<Z){if(S.indexOf("-")!=-1){aa=aa+" "["$*"](Z-Y)}else{var ah=" ";if(S.indexOf("0")!=-1){aa="0"["$*"](Z-Y)+aa}else{ab=" "["$*"](Z-Y)+ab}}}var V=ab+aa;if("XEG".indexOf(U)!=-1){V=V.toUpperCase()}return V})};K.$hash=function(){return this._id};K.$inspect=function(){return this.$to_s()};K["$instance_of?"]=function(M){return this._klass===M};K["$instance_variable_defined?"]=function(M){return n.call(this,M.substr(1))};K.$instance_variable_get=function(M){var N=this[M.substr(1)];return N==null?C:N};K.$instance_variable_set=function(M,N){return this[M.substr(1)]=N};K["$const_defined?"]=function(M){return n.call(this,M)};K.$const_set=function(M,O){this[M]=this._scope[M]=O;var N=function(){return{"$to_s":function(){return M}}};O._klass=O.prototype._klass={"$name":N};O.$name=N;return O};K.$instance_variables=function(){var M=[];for(var N in this){M.push(N)}return M};K["$is_a?"]=function(M){var N=this._klass;while(N){if(N===M){return true}N=N._super}return false};K["$kind_of?"]=K["$is_a?"];K.$lambda=function(M){if(typeof(M)!=="function"){M=C}return M};K.$loop=function(M){if(typeof(M)!=="function"){M=C}while(true){if(M()===G){return G.$v}}return this};K["$nil?"]=function(){return false};K.$object_id=function(){return this._id||(this._id=i++)};K.$printf=function(N){var M=C;N=H.call(arguments,0);if(N.$length()["$>"](0)){M=N.$shift();this.$print(this.$format.apply(this,[M].concat(N)))}return C};K.$proc=function(M){if(typeof(M)!=="function"){M=C}if(M===C){y()}M.is_lambda=false;return M};K.$puts=function(N){N=H.call(arguments,0);for(var M=0;M<N.length;M++){if(N[M] instanceof Array){this.$puts.apply(this,[].concat((N[M])))}else{B.puts((N[M]).$to_s())}}return C};K.$p=function(M){M=H.call(arguments,0);console.log.apply(console,M);if(M.$length()["$<="](1)){return M["$[]"](0)}else{return M}};K.$print=K.$puts;K.$raise=function(N,M){if(typeof(N)==="string"){N=J.RuntimeError.$new(N)}else{if(!N["$is_a?"](J.Exception)){N=N.$new(M)}}throw N};K.$rand=function(M){return M==null?Math.random():Math.floor(Math.random()*M)};K["$respond_to?"]=function(M){return !!this["$"+M]};K.$send=K.$__send__;K.$singleton_class=function(){if(this._isClass){if(this._singleton){return this._singleton}var P=new B.Class;P._klass=B.Class;this._singleton=P;P.prototype=this;return P}if(!this._isObject){return this._klass}function O(){}if(this._singleton){return this._singleton}else{var M=this._klass,N="#<Class:#<"+M._name+":"+M._id+">>";var P=g(M,O);P._name=N;P.prototype=this;this._singleton=P;P._klass=M._klass;return P}};K.$sprintf=K.$format;K.$tap=function(M){if(typeof(M)!=="function"){M=C}if(M(this)===G){return G.$v}return this};K.$to_json=function(){return this.$to_s().$to_json()};K.$to_proc=function(){return this};K.$to_s=function(){return"#<"+this._klass._name+":"+this._id+">"};L._donate(["$initialize","$==","$__send__","$eql?","$equal?","$instance_eval","$instance_exec","$=~","$===","$method","$methods","$Array","$class","$define_singleton_method","$equal?","$extend","$format","$hash","$inspect","$instance_of?","$instance_variable_defined?","$instance_variable_get","$instance_variable_set","$instance_variables","$is_a?","$kind_of?","$lambda","$loop","$nil?","$object_id","$printf","$proc","$puts","$p","$print","$raise","$rand","$respond_to?","$send","$singleton_class","$sprintf","$tap","$to_json","$to_proc","$to_s","$const_defined?","$const_set"])})(D)})();(function(){var B=p,D=B.top,E=B,C=B.nil,F=B.breaker,G=B.slice,H=B.klass;return(function(I,M){function L(){}L=H(I,M,"NilClass",L);var K=L.prototype,J=L._scope;K["$&"]=function(N){return false};K["$|"]=function(N){return N!==false&&N!==C};K["$^"]=function(N){return N!==false&&N!==C};K["$=="]=function(N){return N===C};K.$inspect=function(){return"nil"};K["$nil?"]=function(){return true};K.$singleton_class=function(){return J.NilClass};K.$to_a=function(){return[]};K.$to_i=function(){return 0};K.$to_f=K.$to_i;K.$to_json=function(){return"null"};K.$to_native=function(){return null};K.$to_s=function(){return""};return C})(D,null)})();(function(){var B=p,D=B.top,E=B,C=B.nil,F=B.breaker,G=B.slice,H=B.klass;return(function(I,M){function L(){}L=H(I,M,"Boolean",L);var K=L.prototype,J=L._scope;L.prototype._isBoolean=true;K["$&"]=function(N){return(this==true)?(N!==false&&N!==C):false};K["$|"]=function(N){return(this==true)?true:(N!==false&&N!==C)};K["$^"]=function(N){return(this==true)?(N===false||N===C):(N!==false&&N!==C)};K["$=="]=function(N){return(this==true)===N.valueOf()};K.$singleton_class=K.$class;K.$to_json=function(){return(this==true)?"true":"false"};K.$to_s=function(){return(this==true)?"true":"false"};return C})(D,Boolean)})();(function(){var B=p,D=B.top,E=B,C=B.nil,F=B.breaker,G=B.slice,H=B.klass;(function(I,M){function K(){}K=H(I,M,"Exception",K);K._sdonate(["$new"]);var L=K.prototype,J=K._scope;L.message=C;L.$message=function(){return this.message},C;K.$new=function(O){if(O==null){O=""}var N=new Error(O);N._klass=this;return N};L.$backtrace=function(){var N=this.stack;if(typeof(N)==="string"){return N.split("\n").slice(0,15)}else{if(N){return N.slice(0,15)}}return[]};L.$inspect=function(){return"#<"+(this.$class().$name())+": '"+(this.message)+"'>"};return L.$to_s=L.$message})(D,Error);E.StandardError=E.Exception;E.RuntimeError=E.Exception;E.LocalJumpError=E.Exception;E.TypeError=E.Exception;E.NameError=E.Exception;E.NoMethodError=E.Exception;E.ArgumentError=E.Exception;E.IndexError=E.Exception;E.KeyError=E.Exception;return E.RangeError=E.Exception})();(function(){var B=p,D=B.top,E=B,C=B.nil,F=B.breaker,G=B.slice,I=B.klass,H=B.gvars;(function(J,P){function L(){}L=I(J,P,"Regexp",L);L._sdonate(["$escape","$new"]);var M=L.prototype,K=L._scope;L.$escape=function(Q){return Q.replace(/([.*+?^=!:${}()|[]\/\])/g,"$1")};L.$new=function(R,Q){return new RegExp(R,Q)};M["$=="]=function(Q){return Q.constructor==RegExp&&this.toString()===Q.toString()};M["$==="]=M.test;M["$=~"]=function(R){var Q=this.exec(R);if(Q){Q.$to_s=O;Q.$inspect=N;Q._klass=K.MatchData;H["~"]=Q}else{H["~"]=C}return Q?Q.index:C};M["$eql?"]=M["$=="];M.$inspect=M.toString;M.$match=function(R){var Q=this.exec(R);if(Q){Q.$to_s=O;Q.$inspect=N;Q._klass=K.MatchData;return H["~"]=Q}else{return H["~"]=C}};M.$to_s=function(){return this.source};function O(){return this[0]}function N(){return"<#MatchData "+this[0].$inspect()+">"}})(D,RegExp);return(function(K,N){function J(){}J=I(K,N,"MatchData",J);var M=J.prototype,L=J._scope;return C})(D,null)})();(function(){var B=p,D=B.top,E=B,C=B.nil,G=B.breaker,H=B.slice,F=B.module;return(function(I){function L(){}L=F(I,"Comparable",L);var K=L.prototype,J=L._scope;K["$<"]=function(M){return this["$<=>"](M)["$=="](-1)};K["$<="]=function(M){return this["$<=>"](M)["$<="](0)};K["$=="]=function(M){return this["$<=>"](M)["$=="](0)};K["$>"]=function(M){return this["$<=>"](M)["$=="](1)};K["$>="]=function(M){return this["$<=>"](M)["$>="](0)};K["$between?"]=function(O,M){var N;return((N=this["$>"](O))?this["$<"](M):N)};L._donate(["$<","$<=","$==","$>","$>=","$between?"])})(D)})();(function(){var B=p,D=B.top,E=B,C=B.nil,G=B.breaker,H=B.slice,F=B.module;return(function(I){function L(){}L=F(I,"Enumerable",L);var K=L.prototype,J=L._scope;K["$all?"]=function(O){if(typeof(O)!=="function"){O=C}var M=true,N;if(O!==C){N=function(Q){var P;if((P=O(Q))===G){return G.$v}if(P===false||P===C){M=false;G.$v=C;return G}}}else{N=function(P){if(P===false||P===C){M=false;G.$v=C;return G}}}this.$each(N);return M};K["$any?"]=function(O){if(typeof(O)!=="function"){O=C}var M=false,N;if(O!==C){N=function(Q){var P;if((P=O(Q))===G){return G.$v}if(P!==false&&P!==C){M=true;G.$v=C;return G}}}else{N=function(P){if(P!==false&&P!==C){M=true;G.$v=C;return G}}}this.$each(N);return M};K.$collect=function(O){if(typeof(O)!=="function"){O=C}var M=[];var N=function(){var Q=H.call(arguments),P;if((P=O.apply(null,Q))===G){return G.$v}M.push(P)};this.$each(N);return M};K.$reduce=function(P,Q){var O=arguments.length-1;if(typeof(arguments[O])==="function"&&arguments[O]._s!==l){Q=arguments[O]}else{Q=C}if(P===Q&&typeof(P)==="function"){P=l}var M=P==l?0:P;var N=function(){var S=H.call(arguments),R;if((R=Q.apply(null,[M].concat(S)))===G){M=G.$v;G.$v=C;return G}M=R};this.$each(N);return M};K.$count=function(P,Q){var O=arguments.length-1;if(typeof(arguments[O])==="function"&&arguments[O]._s!==l){Q=arguments[O]}else{Q=C}if(P===Q&&typeof(P)==="function"){P=l}var M=0;if(P!=null){Q=function(R){return(R)["$=="](P)}}else{if(Q===C){Q=function(){return true}}}var N=function(S){var R;if((R=Q(S))===G){return G.$v}if(R!==false&&R!==C){M++}};this.$each(N);return M};K.$detect=function(O,P){var N=arguments.length-1;if(typeof(arguments[N])==="function"&&arguments[N]._s!==l){P=arguments[N]}else{P=C}if(O===P&&typeof(O)==="function"){O=l}var M=C;this.$each(function(R){var Q;if((Q=P(R))===G){return G.$v}if(Q!==false&&Q!==C){M=R;G.$v=C;return G}});if(M!==C){return M}if(typeof(O)==="function"){return O.$call()}return O==null?C:O};K.$drop=function(N){var M=[],O=0;this.$each(function(P){if(N<O){M.push(e)}O++});return M};K.$drop_while=function(N){if(typeof(N)!=="function"){N=C}var M=[];this.$each(function(P){var O;if((O=N(P))===G){return G}if(O===false||O===C){M.push(P);return O}return G});return M};K.$each_with_index=function(N){if(typeof(N)!=="function"){N=C}var M=0;this.$each(function(P){var O;if((O=N(P,M))===G){return G.$v}M++});return C};K.$each_with_object=function(M,N){if(typeof(N)!=="function"){N=C}this.$each(function(P){var O;if((O=N(P,M))===G){return G.$v}});return M};K.$entries=function(){var M=[];this.$each(function(N){M.push(N)});return M};K.$find=K.$detect;K.$find_all=function(N){if(typeof(N)!=="function"){N=C}var M=[];this.$each(function(P){var O;if((O=N(P))===G){return G.$v}if(O!==false&&O!==C){M.push(P)}});return M};K.$find_index=function(Q,R){var P=arguments.length-1;if(typeof(arguments[P])==="function"&&arguments[P]._s!==l){R=arguments[P]}else{R=C}if(Q===R&&typeof(Q)==="function"){Q=l}var N,M=C,O=0;if(Q!=null){N=function(S){if((S)["$=="](Q)){M=O;return G}O+=1}}else{N=function(T){var S;if((S=R(T))===G){return G.$v}if(S!==false&&S!==C){M=O;G.$v=O;return G}O+=1}}this.$each(N);return M};K.$first=function(O){var M=[],P=0,N;if(O==null){M=C;N=function(Q){M=Q;return G}}else{N=function(Q){if(O<=P){return G}M.push(Q);P++}}this.$each(N);return M};K.$grep=function(N,O){if(typeof(O)!=="function"){O=C}var M=[];this.$each(O!==C?function(Q){var P=N["$==="](Q);if(P!==false&&P!==C){if((P=O(Q))===G){return G.$v}M.push(P)}}:function(Q){var P=N["$==="](Q);if(P!==false&&P!==C){M.push(Q)}});return M};K.$map=K.$collect;K.$select=K.$find_all;K.$take=K.$first;K.$to_a=K.$entries;K.$inject=K.$reduce;L._donate(["$all?","$any?","$collect","$reduce","$count","$detect","$drop","$drop_while","$each_with_index","$each_with_object","$entries","$find","$find_all","$find_index","$first","$grep","$map","$select","$take","$to_a","$inject"])})(D)})();(function(){var B=p,D=B.top,E=B,C=B.nil,F=B.breaker,G=B.slice,H=B.klass;return(function(I,M){function K(){}K=H(I,M,"Array",K);K._sdonate(["$[]","$new"]);var L=K.prototype,J=K._scope;K.prototype._isArray=true;K.$include(J.Enumerable);K["$[]"]=function(N){N=G.call(arguments,0);return N};K.$new=function(Q,R,S){var O=arguments.length-1;if(typeof(arguments[O])==="function"&&arguments[O]._s!==l){S=arguments[O]}else{S=C}if(R==null||R===S){R=C}var N=[];if(Q&&Q._isArray){for(var P=0;P<Q.length;P++){N[P]=Q[P]}}else{if(S===C){for(var P=0;P<Q;P++){N[P]=R}}else{for(var P=0;P<Q;P++){N[P]=S(P)}}}return N};L["$&"]=function(T){var V=[],N={};for(var R=0,P=this.length;R<P;R++){var U=this[R];if(!N[U]){for(var Q=0,O=T.length;Q<O;Q++){var S=T[Q];if((U===S)&&!N[U]){N[U]=true;V.push(U)}}}}return V};L["$*"]=function(O){if(typeof(O)==="string"){return this.join(O)}var N=[];for(var P=0;P<O;P++){N=N.concat(this)}return N};L["$+"]=function(N){return this.slice().concat(N.slice())};L["$-"]=function(N){var O;return this.$reject((O=function(Q){var P=O._s||this;if(Q==null){Q=C}return N["$include?"](Q)},O._s=this,O))};L["$<<"]=function(N){this.push(N);return this};L["$<=>"]=function(N){if(this.$hash()===N.$hash()){return 0}if(this.length!=N.length){return(this.length>N.length)?1:-1}for(var P=0,Q=this.length,O;P<Q;P++){if((O=(this[P])["$<=>"](N[P]))!==0){return O}}return 0};L["$=="]=function(N){if(!N||(this.length!==N.length)){return false}for(var O=0,P=this.length;O<P;O++){if(!(this[O])["$=="](N[O])){return false}}return true};L["$[]"]=function(O,Q){var P=this.length;if(typeof O!=="number"){if(O._isRange){var N=O.exclude;Q=O.end;O=O.begin;if(O>P){return C}if(Q<0){Q+=P}if(!N){Q+=1}return this.slice(O,Q)}else{this.$raise("bad arg for Array#[]")}}if(O<0){O+=P}if(Q!==l){if(Q<0||O>P||O<0){return C}return this.slice(O,O+Q)}else{if(O>=P||O<0){return C}return this[O]}};L["$[]="]=function(N,P){var O=this.length;if(N<0){N+=O}return this[N]=P};L.$assoc=function(N){for(var O=0,Q=this.length,P;O<Q;O++){if(P=this[O],P.length&&(P[0])["$=="](N)){return P}}return C};L.$at=function(N){if(N<0){N+=this.length}if(N<0||N>=this.length){return C}return this[N]};L.$clear=function(){this.splice(0,this.length);return this};L.$clone=function(){return this.slice()};L.$collect=function(R){if(typeof(R)!=="function"){R=C}var N=[];for(var O=0,P=this.length,Q;O<P;O++){if((Q=R(this[O]))===F){return F.$v}N.push(Q)}return N};L["$collect!"]=function(Q){if(typeof(Q)!=="function"){Q=C}for(var N=0,O=this.length,P;N<O;N++){if((P=Q(this[N]))===F){return F.$v}this[N]=P}return this};L.$compact=function(){var N=[];for(var O=0,Q=this.length,P;O<Q;O++){if((P=this[O])!==C){N.push(P)}}return N};L["$compact!"]=function(){var O=this.length;for(var N=0,P=this.length;N<P;N++){if(this[N]===C){this.splice(N,1);P--;N--}}return this.length===O?C:this};L.$concat=function(N){for(var O=0,P=N.length;O<P;O++){this.push(N[O])}return this};L.$count=function(O){if(O==null){return this.length}var N=0;for(var P=0,Q=this.length;P<Q;P++){if((this[P])["$=="](O)){N++}}return N};L.$delete=function(N){var P=this.length;for(var O=0,Q=P;O<Q;O++){if((this[O])["$=="](N)){this.splice(O,1);Q--;O--}}return this.length===P?C:N};L.$delete_at=function(O){if(O<0){O+=this.length}if(O<0||O>=this.length){return C}var N=this[O];this.splice(O,1);return N};L.$delete_if=function(Q){if(typeof(Q)!=="function"){Q=C}for(var N=0,O=this.length,P;N<O;N++){if((P=Q(this[N]))===F){return F.$v}if(P!==false&&P!==C){this.splice(N,1);O--;N--}}return this};L.$drop=function(N){return this.slice(N)};L.$dup=L.$clone;L.$each=function(P){if(typeof(P)!=="function"){P=C}for(var N=0,O=this.length;N<O;N++){if(P(this[N])===F){return F.$v}}return this};L.$each_index=function(P){if(typeof(P)!=="function"){P=C}for(var N=0,O=this.length;N<O;N++){if(P(N)===F){return F.$v}}return this};L["$empty?"]=function(){return !this.length};L.$fetch=function(N,P,Q){if(typeof(Q)!=="function"){Q=C}var O=N;if(N<0){N+=this.length}if(N>=0&&N<this.length){return this[N]}if(P!=null){return P}if(Q!==C){return Q(O)}this.$raise("Array#fetch")};L.$first=function(N){if(N!=null){return this.slice(0,N)}return this.length===0?C:this[0]};L.$flatten=function(R){var N=[];for(var O=0,Q=this.length,P;O<Q;O++){P=this[O];if(P._isArray){if(R==null){N=N.concat((P).$flatten())}else{if(R===0){N.push(P)}else{N=N.concat((P).$flatten(R-1))}}}else{N.push(P)}}return N};L["$flatten!"]=function(O){var N=this.length;this.$replace(this.$flatten(O));return N===this.length?C:this};L.$hash=function(){return this._id||(this._id=i++)};L["$include?"]=function(P){for(var N=0,O=this.length;N<O;N++){if((this[N])["$=="](P)){return true}}return false};L.$index=function(O,S){var N=arguments.length-1;if(typeof(arguments[N])==="function"&&arguments[N]._s!==l){S=arguments[N]}else{S=C}if(O===S&&typeof(O)==="function"){O=l}if(O!=null){for(var P=0,Q=this.length;P<Q;P++){if((this[P])["$=="](O)){return P}}}else{if(S!==C){for(var P=0,Q=this.length,R;P<Q;P++){if((R=S(this[P]))===F){return F.$v}if(R!==false&&R!==C){return P}}}}return C};L.$insert=function(N,P){P=G.call(arguments,1);if(P.length>0){if(N<0){N+=this.length+1;if(N<0){this.$raise(""+(N)+" is out of bounds")}}if(N>this.length){for(var O=this.length;O<N;O++){this.push(C)}}this.splice.apply(this,[N,0].concat(P))}return this};L.$inspect=function(){var O,S,P,N,Q,R;S=[];R=this.$object_id();Q=this.length;for(O=0;O<Q;O++){P=this["$[]"](O);N=(P).$object_id()===R?"[...]":(P).$inspect();S.push(N)}return"["+S.join(", ")+"]"};L.$join=function(O){if(O==null){O=""}var N=[];for(var P=0,Q=this.length;P<Q;P++){N.push((this[P]).$to_s())}return N.join(O)};L.$keep_if=function(Q){if(typeof(Q)!=="function"){Q=C}for(var N=0,O=this.length,P;N<O;N++){if((P=Q(this[N]))===F){return F.$v}if(P===false||P===C){this.splice(N,1);O--;N--}}return this};L.$last=function(O){var N=this.length;if(O==null){return N===0?C:this[N-1]}else{if(O<0){this.$raise("negative count given")}}if(O>N){O=N}return this.slice(N-O,N)};L.$length=function(){return this.length};L.$map=L.$collect;L["$map!"]=L["$collect!"];L.$pop=function(O){var N=this.length;if(O==null){return N===0?C:this.pop()}if(O<0){this.$raise("negative count given")}return O>N?this.splice(0,this.length):this.splice(N-O,N)};L.$push=function(P){P=G.call(arguments,0);for(var N=0,O=P.length;N<O;N++){this.push(P[N])}return this};L.$rassoc=function(N){for(var O=0,Q=this.length,P;O<Q;O++){P=this[O];if(P.length&&P[1]!==l){if((P[1])["$=="](N)){return P}}}return C};L.$reject=function(R){if(typeof(R)!=="function"){R=C}var N=[];for(var O=0,P=this.length,Q;O<P;O++){if((Q=R(this[O]))===F){return F.$v}if(Q===false||Q===C){N.push(this[O])}}return N};L["$reject!"]=function(O){if(typeof(O)!=="function"){O=C}var N=this.length;this.$delete_if(O.$to_proc());return this.length===N?C:this};L.$replace=function(N){this.splice(0,this.length);this.push.apply(this,N);return this};L.$reverse=L.reverse;L["$reverse!"]=function(){this.splice(0);this.push.apply(this,this.$reverse());return this};L.$reverse_each=function(N){if(typeof(N)!=="function"){N=C}this.$reverse().$each(N.$to_proc());return this};L.$rindex=function(O,R){var N=arguments.length-1;if(typeof(arguments[N])==="function"&&arguments[N]._s!==l){R=arguments[N]}else{R=C}if(O===R&&typeof(O)==="function"){O=l}if(R!==C){for(var P=this.length-1,Q;P>=0;P--){if((Q=R(this[P]))===F){return F.$v}if(Q!==false&&Q!==C){return P}}}else{for(var P=this.length-1;P>=0;P--){if((this[P])["$=="](O)){return P}}}return C};L.$select=function(S){if(typeof(S)!=="function"){S=C}var N=[];for(var O=0,Q=this.length,P,R;O<Q;O++){P=this[O];if((R=S(P))===F){return F.$v}if(R!==false&&R!==C){N.push(P)}}return N};L["$select!"]=function(O){if(typeof(O)!=="function"){O=C}var N=this.length;this.$keep_if(O.$to_proc());return this.length===N?C:this};L.$shift=function(N){if(this.length===0){return C}return N==null?this.shift():this.splice(0,N)};L.$size=L.$length;L.$slice=L["$[]"];L["$slice!"]=function(N,O){if(N<0){N+=this.length}if(O!=null){return this.splice(N,O)}if(N<0||N>=this.length){return C}return this.splice(N,1)[0]};L.$take=function(N){return this.slice(0,N)};L.$take_while=function(S){if(typeof(S)!=="function"){S=C}var N=[];for(var O=0,Q=this.length,P,R;O<Q;O++){P=this[O];if((R=S(P))===F){return F.$v}if(R===false||R===C){return N}N.push(P)}return N};L.$to_a=function(){return this};L.$to_ary=L.$to_a;L.$to_json=function(){var N=[];for(var O=0,P=this.length;O<P;O++){N.push((this[O]).$to_json())}return"["+N.join(", ")+"]"};L.$to_s=L.$inspect;L.$uniq=function(){var N=[],O={};for(var P=0,R=this.length,Q,S;P<R;P++){Q=this[P];S=Q;if(!O[S]){O[S]=true;N.push(Q)}}return N};L["$uniq!"]=function(){var P=this.length,N={};for(var O=0,R=P,Q,S;O<R;O++){Q=this[O];S=Q;if(!N[S]){N[S]=true}else{this.splice(O,1);R--;O--}}return this.length===P?C:this};L.$unshift=function(O){O=G.call(arguments,0);for(var N=O.length-1;N>=0;N--){this.unshift(O[N])}return this};L.$zip=function(N,Q){var Q;N=G.call(arguments,0);if(typeof(N[N.length-1])==="function"){Q=N.pop()}else{Q=C}var V=[],U=this.length,P,O;for(var S=0;S<U;S++){P=[this[S]];for(var R=0,T=N.length;R<T;R++){O=N[R][S];if(O==null){O=C}P[R+1]=O}V[S]=P}if(Q!==C){for(var S=0;S<U;S++){Q(V[S])}return C}return V};L.$sort=function(N){if(typeof(N)!=="function"){N=C}var O=this.slice();if(N!==C){return O.sort(N)}return O.sort()};L["$sort!"]=function(N){if(typeof(N)!=="function"){N=C}if(N!==C){return this.sort(N)}return this.sort()};return C})(D,Array)})();(function(){var B=p,D=B.top,E=B,C=B.nil,F=B.breaker,G=B.slice,H=B.klass;return(function(I,M){function K(){}K=H(I,M,"Hash",K);K._sdonate(["$[]","$allocate","$from_native","$new"]);var L=K.prototype,J=K._scope;L.proc=L.none=C;K.$include(J.Enumerable);__hash=p.hash=function(){var T=new K,N=G.call(arguments),R=[],U={};T.map=U;T.keys=R;for(var P=0,Q=N.length,O;P<Q;P++){var O=N[P],S=N[++P];if(U[O]==null){R.push(O)}U[O]=S}return T};__hash2=p.hash2=function(O){var N=new K;N.map=O;return N};K["$[]"]=function(N){N=G.call(arguments,0);return __hash.apply(null,N)};K.$allocate=function(){return __hash()};K.$from_native=function(Q){var P=__hash(),O=P.map;for(var N in Q){O[N]=Q[N]}return P};K.$new=function(P,Q){var N=arguments.length-1;if(typeof(arguments[N])==="function"&&arguments[N]._s!==l){Q=arguments[N]}else{Q=C}if(P===Q&&typeof(P)==="function"){P=l}var O=__hash();if(P!=null){O.none=P}else{if(Q!==C){O.proc=Q}}return O};L["$=="]=function(N){var P;if(this===N){return true}if(N.map==null){return false}var T=this.map,S=N.map;for(var O in T){var R=T[O],Q=S[O];if((P=(R)["$=="](Q),(P===C||P===false))){return false}}return true};L["$[]"]=function(O){var P=this.map[O];if(P!=null){return P}var N=this.proc;if(N!==C){return(N).$call(this,O)}return this.none};L["$[]="]=function(N,O){this.map[N]=O;return O};L.$assoc=function(N){var P=this.map;for(var O in P){if((O)["$=="](N)){return[O,P[O]]}}return C};L.$clear=function(){this.map={};return this};L.$clone=function(){var N=__hash(),Q=this.map,P=N.map;for(var O in Q){P[O]=Q[O]}return N};L.$default=function(){return this.none};L["$default="]=function(N){return this.none=N};L.$default_proc=function(){return this.proc};L["$default_proc="]=function(N){return this.proc=N};L.$delete=function(O){var P=this.map,N=P[O];if(N!=null){delete P[O];return N}return C};L.$delete_if=function(Q){if(typeof(Q)!=="function"){Q=C}var P=this.map,O;for(var N in P){if((O=Q(N,P[N]))===F){return F.$v}if(O!==false&&O!==C){delete P[N]}}return this};L.$dup=L.$clone;L.$each=function(P){if(typeof(P)!=="function"){P=C}var O=this.map;for(var N in O){if(P(N,O[N])===F){return F.$v}}return this};L.$each_key=function(P){if(typeof(P)!=="function"){P=C}var O=this.map;for(var N in O){if(P(N)===F){return F.$v}}return this};L.$each_pair=L.$each;L.$each_value=function(P){if(typeof(P)!=="function"){P=C}var O=this.map;for(var N in O){if(P(O[N])===F){return F.$v}}return this};L["$empty?"]=function(){for(var N in this.map){return false}return true};L["$eql?"]=L["$=="];L.$fetch=function(O,Q,R){var N=arguments.length-1;if(typeof(arguments[N])==="function"&&arguments[N]._s!==l){R=arguments[N]}else{R=C}if(Q===R&&typeof(Q)==="function"){Q=l}var P=this.map[O];if(P!=null){return P}if(R!==C){var P;if((P=R(O))===F){return F.$v}return P}if(Q!=null){return Q}this.$raise("key not found")};L.$flatten=function(R){var Q=this.map,N=[];for(var O in Q){var P=Q[O];N.push(O);if(P._isArray){if(R==null||R===1){N.push(P)}else{N=N.concat((P).$flatten(R-1))}}else{N.push(P)}}return N};L["$has_key?"]=function(N){return this.map[N]!=null};L["$has_value?"]=function(O){var P=this.map;for(var N in P){if((P[N])["$=="](O)){return true}}return false};L.$hash=function(){return this._id};L["$include?"]=L["$has_key?"];L.$index=function(N){var P=this.map;for(var O in P){if(N["$=="](P[O])){return O}}return C};L.$indexes=function(Q){Q=G.call(arguments,0);var N=[],R=this.map,S;for(var O=0,P=Q.length;O<P;O++){S=R[Q[O]];if(S!=null){N.push(S)}else{N.push(this.none)}}return N};L.$indices=L.$indexes;L.$inspect=function(){var P=[],O=this.map;for(var N in O){P.push((N).$inspect()+"=>"+(O[N]).$inspect())}return"{"+P.join(", ")+"}"};L.$invert=function(){var N=__hash(),R=this.map,Q=N.map;for(var O in R){var P=R[O];Q[P]=O}return N};L.$keep_if=function(R){if(typeof(R)!=="function"){R=C}var Q=this.map,O;for(var N in Q){var P=Q[N];if((O=R(N,P))===F){return F.$v}if(O===false||O===C){delete Q[N]}}return this};L.$key=L.$index;L["$key?"]=L["$has_key?"];L.$keys=function(){var N=[],P=this.map;for(var O in P){N.push(O)}return N};L.$length=function(){var O=0,P=this.map;for(var N in P){O++}return O};L["$member?"]=L["$has_key?"];L.$merge=function(O,S){if(typeof(S)!=="function"){S=C}var R=this.map,N=__hash(),Q=N.map;for(var P in R){Q[P]=R[P]}R=O.map;if(S===C){for(P in R){Q[P]=R[P]}}else{for(P in R){if(Q[P]==null){Q[P]=R[P]}else{Q[P]=S(P,Q[P],R[P])}}}return N};L["$merge!"]=function(N,R){if(typeof(R)!=="function"){R=C}var Q=this.map,P=N.map;if(R===C){for(var O in P){Q[O]=P[O]}}else{for(O in P){if(Q[O]==null){Q[O]=P[O]}else{Q[O]=R(O,Q[O],P[O])}}}return this};L.$rassoc=function(N){var Q=this.map;for(var O in Q){var P=Q[O];if((P)["$=="](N)){return[O,P]}}return C};L.$reject=function(T){if(typeof(T)!=="function"){T=C}var S=this.map,N=__hash(),R=N.map;for(var O in S){var Q=S[O],P;if((P=T(O,Q))===F){return F.$v}if(P===false||P===C){R[O]=Q}}return N};L.$replace=function(N){var Q=this.map={},P=N.map;for(var O in P){Q[O]=P[O]}return this};L.$select=function(T){if(typeof(T)!=="function"){T=C}var S=this.map,N=__hash(),R=N.map;for(var O in S){var Q=S[O],P;if((P=T(O,Q))===F){return F.$v}if(P!==false&&P!==C){R[O]=Q}}return N};L["$select!"]=function(S){if(typeof(S)!=="function"){S=C}var R=this.map,P,N=C;for(var O in R){var Q=R[O];if((P=S(O,Q))===F){return F.$v}if(P===false||P===C){delete R[O];N=this}}return N};L.$shift=function(){var P=this.map;for(var N in P){var O=P[N];delete P[N];return[N,O]}return C};L.$size=L.$length;L.$to_a=function(){var P=this.map,N=[];for(var O in P){N.push([O,P[O]])}return N};L.$to_hash=function(){return this};L.$to_json=function(){var P=[],O=this.map;for(var N in O){P.push((N).$to_json()+": "+(O[N]).$to_json())}return"{"+P.join(", ")+"}"};L.$to_native=function(){var N={},Q=this.map;for(var O in Q){var P=Q[O];if(P.$to_native){N[O]=(P).$to_native()}else{N[O]=P}}return N};L.$to_s=L.$inspect;L.$update=L["$merge!"];L["$value?"]=function(O){var P=this.map;for(var Q in P){var N=P[Q];if((N)["$=="](O)){return true}}return false};L.$values_at=L.$indexes;L.$values=function(){var P=this.map,N=[];for(var O in P){N.push(P[O])}return N};return C})(D,null)})();(function(){var B=p,D=B.top,E=B,C=B.nil,F=B.breaker,G=B.slice,I=B.klass,H=B.gvars;(function(J,N){function K(){}K=I(J,N,"String",K);K._sdonate(["$try_convert","$new"]);var M=K.prototype,L=K._scope;K.prototype._isString=true;K.$include(L.Comparable);K.$try_convert=function(P){try{return P.$to_str()}catch(O){if(true){C}else{throw O}}};K.$new=function(O){if(O==null){O=""}return new K(O)};M["$%"]=function(P){var O;if((O=P["$is_a?"](L.Array))!==false&&O!==C){return this.$format.apply(this,[this].concat(P))}else{return this.$format(this,P)}};M["$*"]=function(P){if(P<1){return""}var O="",Q=this.valueOf();while(P>0){if(P&1){O+=Q}P>>=1,Q+=Q}return O};M["$+"]=function(O){return this.toString()+O};M["$<=>"]=function(O){if(typeof O!=="string"){return C}return this>O?1:(this<O?-1:0)};M["$<"]=function(O){return this<O};M["$<="]=function(O){return this<=O};M["$>"]=function(O){return this>O};M["$>="]=function(O){return this>=O};M["$=="]=function(O){return O==K(this)};M["$==="]=M["$=="];M["$=~"]=function(O){if(typeof O==="string"){this.$raise("string given")}return O["$=~"](this)};M["$[]"]=function(P,R){var Q=this.length;if(P._isRange){var O=P.exclude,R=P.end,P=P.begin;if(P>Q){return C}if(R<0){R+=Q}if(O){R-=1}return this.substr(P,R)}if(P<0){P+=this.length}if(R==null){if(P>=this.length||P<0){return C}return this.substr(P,1)}if(P>this.length||P<0){return C}return this.substr(P,R)};M.$capitalize=function(){return this.charAt(0).toUpperCase()+this.substr(1).toLowerCase()};M.$casecmp=function(P){if(typeof P!=="string"){return P}var Q=this.toLowerCase(),O=P.toLowerCase();return Q>O?1:(Q<O?-1:0)};M.$chars=function(O){if(typeof(O)!=="function"){O=C}for(var P=0,Q=this.length;P<Q;P++){if(O(this.charAt(P))===F){return F.$v}}};M.$chomp=function(O){if(O==null){O=H["/"]}if(O==="\n"){return this.replace(/(\n|\r|\r\n)$/,"")}else{if(O===""){return this.replace(/(\n|\r\n)+$/,"")}}return this.replace(new RegExp(O+"$"),"")};M.$chop=function(){return this.substr(0,this.length-1)};M.$chr=function(){return this.charAt(0)};M.$count=function(O){return(this.length-this.replace(new RegExp(O,"g"),"").length)/O.length};M.$demodulize=function(){var O=this.lastIndexOf("::");if(O>-1){return this.substr(O+2)}return this};M.$downcase=M.toLowerCase;M.$each_char=M.$chars;M.$each_line=function(S,O){var P=arguments.length-1;if(typeof(arguments[P])==="function"&&arguments[P]._s!==l){O=arguments[P]}else{O=C}if(S==null||S===O){S=H["/"]}var T=this.split(S);for(var Q=0,R=T.length;Q<R;Q++){if(O(T[Q]+S)===F){return F.$v}}};M["$empty?"]=function(){return this.length===0};M["$end_with?"]=function(O){O=G.call(arguments,0);for(var P=0,Q=O.length;P<Q;P++){var R=O[P];if(this.lastIndexOf(R)===this.length-R.length){return true}}return false};M["$eql?"]=M["$=="];M["$equal?"]=function(O){return this.toString()===O.toString()};M.$getbyte=M.charCodeAt;M.$gsub=function(S,Q){var P;if((P=S["$is_a?"](L.String))!==false&&P!==C){S=(new RegExp(""+L.Regexp.$escape(S)))}var S=S.toString(),O=S.substr(S.lastIndexOf("/")+1)+"g",R=S.substr(1,S.lastIndexOf("/")-1);return this.$sub(new RegExp(R,O),Q)};M.$hash=M.toString;M.$hex=function(){return this.$to_i(16)};M["$include?"]=function(O){return this.indexOf(O)!==-1};M.$index=function(Q,R){var P;if(!Q._isString&&!Q._isRegexp){throw new Error("type mismatch")}var O=-1;if(R!=null){if(R<0){R=this.length-R}if(Q["$is_a?"](L.Regexp)){O=((P=Q["$=~"](this.substr(R))),P!==false&&P!==C?P:-1)}else{O=this.substr(R).indexOf(substr)}if(O!==-1){O+=R}}else{if(Q["$is_a?"](L.Regexp)){O=((P=Q["$=~"](this)),P!==false&&P!==C?P:-1)}else{O=this.indexOf(substr)}}return O===-1?C:O};M.$inspect=function(){var P=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,O={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"};P.lastIndex=0;return P.test(this)?'"'+this.replace(P,function(Q){var R=O[Q];return typeof R==="string"?R:"\\u"+("0000"+Q.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+this+'"'};M.$intern=function(){return this};M.$lines=M.$each_line;M.$length=function(){return this.length};M.$ljust=function(O,P){if(P==null){P=" "}return this.$raise(L.NotImplementedError)};M.$lstrip=function(){return this.replace(/^\s*/,"")};M.$match=function(P,R,Q){var O;if(typeof(Q)!=="function"){Q=C}return(function(){if((O=P["$is_a?"](L.Regexp))!==false&&O!==C){return P}else{return(new RegExp(""+L.Regexp.$escape(P)))}return C}).call(this).$match(this,R,Q.$to_proc())};M.$next=function(){if(this.length===0){return""}var O=this.substr(0,this.length-1);var P=K.fromCharCode(this.charCodeAt(this.length-1)+1);return O+P};M.$ord=function(){return this.charCodeAt(0)};M.$partition=function(Q){var O=this.split(Q);var P=(O[0].length===this.length?"":Q);return[O[0],P,O.slice(1).join(Q.toString())]};M.$reverse=function(){return this.split("").reverse().join("")};M.$rstrip=function(){return this.replace(/\s*$/,"")};M.$size=M.$length;M.$slice=M["$[]"];M.$split=function(Q,O){var P;if(Q==null){Q=((P=H[";"]),P!==false&&P!==C?P:" ")}return this.split(Q,O)};M["$start_with?"]=function(Q){Q=G.call(arguments,0);for(var O=0,P=Q.length;O<P;O++){if(this.indexOf(Q[O])===0){return true}}return false};M.$strip=function(){return this.replace(/^\s*/,"").replace(/\s*$/,"")};M.$sub=function(Q,P,R){var O=arguments.length-1;if(typeof(arguments[O])==="function"&&arguments[O]._s!==l){R=arguments[O]}else{R=C}if(P===R&&typeof(P)==="function"){P=l}if(typeof(P)==="string"){return this.replace(Q,P)}if(R!==C){return this.replace(Q,function(T,S){H["1"]=S;return R(T)})}else{if(P!==l){if(P["$is_a?"](L.Hash)){return this.replace(Q,function(T){var S=P["$[]"](this.$str());return(S==null)?C:this.$value().$to_s()})}else{P=L.String.$try_convert(P);if(P==null){this.$raise(L.TypeError,"can't convert "+(P.$class())+" into String")}return this.replace(Q,P)}}else{return this.replace(Q,P.toString())}}};M.$succ=M.$next;M.$sum=function(R){if(R==null){R=16}var O=0;for(var P=0,Q=this.length;P<Q;P++){O+=(this.charCodeAt(P)%((1<<R)-1))}return O};M.$swapcase=function(){var O=this.replace(/([a-z]+)|([A-Z]+)/g,function(Q,P,R){return P?Q.toUpperCase():Q.toLowerCase()});if(this._klass===K){return O}return this.$class().$new(O)};M.$to_a=function(){if(this.length===0){return[]}return[this]};M.$to_f=function(){var O=parseFloat(this);return isNaN(O)?0:O};M.$to_i=function(P){if(P==null){P=10}var O=parseInt(this,P);if(isNaN(O)){return 0}return O};M.$to_json=M.$inspect;M.$to_proc=function(){var O="$"+this;return function(P){return P[O](P)}};M.$to_s=M.toString;M.$to_str=M.$to_s;M.$to_sym=M.$intern;M.$underscore=function(){return this.replace(/[-\s]+/g,"_").replace(/([A-Z\d]+)([A-Z][a-z])/g,"$1_$2").replace(/([a-z\d])([A-Z])/g,"$1_$2").toLowerCase()};return M.$upcase=M.toUpperCase})(D,String);return E.Symbol=E.String})();(function(){var B=p,D=B.top,E=B,C=B.nil,F=B.breaker,G=B.slice,H=B.klass;(function(J,M){function I(){}I=H(J,M,"Numeric",I);var L=I.prototype,K=I._scope;I.prototype._isNumber=true;I.$include(K.Comparable);L["$+"]=function(N){return this+N};L["$-"]=function(N){return this-N};L["$*"]=function(N){return this*N};L["$/"]=function(N){return this/N};L["$%"]=function(N){return this%N};L["$&"]=function(N){return this&N};L["$|"]=function(N){return this|N};L["$^"]=function(N){return this^N};L["$<"]=function(N){return this<N};L["$<="]=function(N){return this<=N};L["$>"]=function(N){return this>N};L["$>="]=function(N){return this>=N};L["$<<"]=function(N){return this<<N};L["$>>"]=function(N){return this>>N};L["$+@"]=function(){return +this};L["$-@"]=function(){return -this};L["$~"]=function(){return ~this};L["$**"]=function(N){return Math.pow(this,N)};L["$=="]=function(N){return this==N};L["$<=>"]=function(N){if(typeof(N)!=="number"){return C}return this<N?-1:(this>N?1:0)};L.$abs=function(){return Math.abs(this)};L.$ceil=function(){return Math.ceil(this)};L.$chr=function(){return String.fromCharCode(this)};L.$downto=function(O,P){if(typeof(P)!=="function"){P=C}for(var N=this;N>=O;N--){if(P(N)===F){return F.$v}}return this};L["$eql?"]=L["$=="];L["$even?"]=function(){return this%2===0};L.$floor=function(){return Math.floor(this)};L.$hash=function(){return this.toString()};L["$integer?"]=function(){return this%1===0};L.$magnitude=L.$abs;L.$modulo=L["$%"];L.$next=function(){return this+1};L["$nonzero?"]=function(){return this===0?C:this};L["$odd?"]=function(){return this%2!==0};L.$ord=function(){return this};L.$pred=function(){return this-1};L.$succ=L.$next;L.$times=function(O){if(typeof(O)!=="function"){O=C}for(var N=0;N<this;N++){if(O(N)===F){return F.$v}}return this};L.$to_f=function(){return parseFloat(this)};L.$to_i=function(){return parseInt(this)};L.$to_json=function(){return this.toString()};L.$to_s=function(N){if(N==null){N=10}return this.toString()};L.$upto=function(O,P){if(typeof(P)!=="function"){P=C}for(var N=this;N<=O;N++){if(P(N)===F){return F.$v}}return this};L["$zero?"]=function(){return this==0};return C})(D,Number);return E.Fixnum=E.Numeric})();(function(){var B=p,D=B.top,E=B,C=B.nil,F=B.breaker,G=B.slice,H=B.klass;(function(I,M){function L(){}L=H(I,M,"Proc",L);L._sdonate(["$new"]);var K=L.prototype,J=L._scope;L.prototype._isProc=true;L.prototype.is_lambda=true;L.$new=function(N){if(typeof(N)!=="function"){N=C}if(N===C){y()}N.is_lambda=false;return N};K.$call=function(N){N=G.call(arguments,0);return this.apply(null,N)};K.$to_proc=function(){return this};K["$lambda?"]=function(){return !!this.is_lambda};K.$arity=function(){return this.length-1};return C})(D,Function);return(function(I,M){function L(){}L=H(I,M,"Method",L);var K=L.prototype,J=L._scope;return C})(D,E.Proc)})();(function(){var B=p,D=B.top,E=B,C=B.nil,F=B.breaker,G=B.slice,H=B.klass;return(function(I,M){function L(){}L=H(I,M,"Range",L);var K=L.prototype,J=L._scope;K.begin=K.end=C;L.$include(J.Enumerable);L.prototype._isRange=true;p.range=function(Q,O,N){var P=new L;P.begin=Q;P.end=O;P.exclude=N;return P};K.$begin=function(){return this.begin},C;K.$end=function(){return this.end},C;K.$initialize=function(P,N,O){if(O==null){O=false}this.begin=P;this.end=N;return this.exclude=O};K["$=="]=function(N){if(!N._isRange){return false}return this.exclude===N.exclude&&this.begin==N.begin&&this.end==N.end};K["$==="]=function(N){return N>=this.begin&&(this.exclude?N<this.end:N<=this.end)};K["$cover?"]=function(P){var O,N;return((O=(this.begin)["$<="](P))?P["$<="]((function(){if((N=this["$exclude_end?"]())!==false&&N!==C){return(this.end)["$-"](1)}else{return this.end}return C}).call(this)):O)};K.$each=function(R){var Q=C,P,O,N;if(typeof(R)!=="function"){R=C}Q=this.$min();while((O=(N=Q["$=="](this.$max()),(N===C||N===false)))!==false&&O!==C){if(R(Q)===F){return F.$v}Q=Q.$succ()}if((P=this["$exclude_end?"]())===false||P===C){if(R(Q)===F){return F.$v}}return this};K["$eql?"]=function(N){var O;if((O=J.Range["$==="](N))===false||O===C){return false}return(O=((O=this["$exclude_end?"]()["$=="](N["$exclude_end?"]()))?(this.begin)["$eql?"](N.$begin()):O),O!==false&&O!==C?(this.end)["$eql?"](N.$end()):O)};K["$exclude_end?"]=function(){return this.exclude};K["$include?"]=function(N){return obj>=this.begin&&obj<=this.end};K.$max=K.$end;K.$min=K.$begin;K["$member?"]=K["$include?"];K.$step=function(N){if(N==null){N=1}return this.$raise(J.NotImplementedError)};K.$to_s=function(){return this.begin+(this.exclude?"...":"..")+this.end};return K.$inspect=K.$to_s})(D,null)})();(function(){var B=p,D=B.top,E=B,C=B.nil,F=B.breaker,G=B.slice,H=B.klass;return(function(I,M){function K(){}K=H(I,M,"Time",K);K._sdonate(["$at","$new","$now"]);var L=K.prototype,J=K._scope;K.$include(J.Comparable);K.$at=function(O,N){if(N==null){N=0}return new Date(O*1000+N)};K.$new=function(Q,S,O,N,T,P,R){switch(arguments.length){case 1:return new Date(Q);case 2:return new Date(Q,S-1);case 3:return new Date(Q,S-1,O);case 4:return new Date(Q,S-1,O,N);case 5:return new Date(Q,S-1,O,N,T);case 6:return new Date(Q,S-1,O,N,T,P);case 7:return new Date(Q,S-1,O,N,T,P,R);default:return new Date()}};K.$mktime=function(Q,S,O,N,T,P,R){return K.$new(Q,S,O,N,T,P,R)};K.$now=function(){return new Date()};L["$+"]=function(N){return J.Time.$allocate(this.$to_f()["$+"](N.$to_f()))};L["$-"]=function(N){return J.Time.$allocate(this.$to_f()["$-"](N.$to_f()))};L["$<=>"]=function(N){return this.$to_f()["$<=>"](N.$to_f())};L.$day=L.getDate;L["$eql?"]=function(N){var O;return(O=N["$is_a?"](J.Time),O!==false&&O!==C?this["$<=>"](N)["$zero?"]():O)};L["$friday?"]=function(){return this.getDay()===5};L.$hour=L.getHours;L.$inspect=L.toString;L.$mday=L.$day;L.$min=L.getMinutes;L.$mon=function(){return this.getMonth()+1};L["$monday?"]=function(){return this.getDay()===1};L.$month=L.$mon;L["$saturday?"]=function(){return this.getDay()===6};L.$sec=L.getSeconds;L["$sunday?"]=function(){return this.getDay()===0};L["$thursday?"]=function(){return this.getDay()===4};L.$to_f=function(){return this.getTime()/1000};L.$to_i=function(){return parseInt(this.getTime()/1000)};L.$to_s=L.$inspect;L["$tuesday?"]=function(){return this.getDay()===2};L.$wday=L.getDay;L["$wednesday?"]=function(){return this.getDay()===3};return L.$year=L.getFullYear})(D,Date)})();(function(){var H=C,B=p,D=B.top,E=B,C=B.nil,F=B.breaker,G=B.slice,I=B.klass;H=Date;return(function(K,N){function J(){}J=I(K,N,"Date",J);J._sdonate(["$today"]);var M=J.prototype,L=J._scope;J.$today=function(){var O=this.$new();O._date=new H();return O};M.$initialize=function(P,Q,O){return this._date=new H(P,Q-1,O)};M.$day=function(){return this._date.getDate()};M.$month=function(){return this._date.getMonth()+1};M.$to_s=function(){var O=this._date;return""+O.getFullYear()+"-"+(O.getMonth()+1)+"-"+O.getDate()};M.$year=function(){return this._date.getFullYear()};return C})(D,null)})();(function(){var H=p,J=H.top,F=H,G=H.nil,B=H.breaker,C=H.slice,E=H.module,I=H.hash2;var D=JSON.parse;return(function(K){function O(){}O=E(K,"JSON",O);var N=O.prototype,L=O._scope;O.$parse=function(P){return M(D(P))};O.$from_object=function(P){return M(P)};function M(U){switch(typeof U){case"string":return U;case"number":return U;case"boolean":return !!U;case"null":return G;case"object":if(!U){return G}if(U._isArray){var P=[];for(var S=0,T=U.length;S<T;S++){P.push(M(U[S]))}return P}else{var W=I({}),R,V=W.map;for(var Q in U){if(n.call(U,Q)){R=M(U[Q]);V[Q]=R}}}return W}}O._sdonate(["$parse","$from_object"])})(J)})();(function(){var B=p,D=B.top,E=B,C=B.nil,F=B.breaker,H=B.slice,I=B.klass,G=B.hash2;return(function(J,N){function M(){}M=I(J,N,"ERB",M);M._sdonate(["$[]","$[]="]);var L=M.prototype,K=M._scope;L.body=C;M._cache=G({});M["$[]"]=function(O){if(this._cache==null){this._cache=C}return this._cache["$[]"](O)};M["$[]="]=function(P,O){if(this._cache==null){this._cache=C}return this._cache["$[]="](P,O)};L.$initialize=function(P,O){if(typeof(O)!=="function"){O=C}this.body=O;this.name=P;return K.ERB["$[]="](P,this)};L.$render=function(O){if(O==null){O=this}return O.$instance_eval(this.body.$to_proc())};return C})(D,null)})()}).call(this);Opal.Database=(function(){var h=["DROP TABLE IF EXISTS client_info;","CREATE TABLE client_info (",'        "client_id" VARCHAR(255) default NULL,','        "session" VARCHAR(255) default NULL,','        "token" VARCHAR(255) default NULL,','        "token_sent" BIGINT default 0,','        "reset" BIGINT default 0,','        "port" VARCHAR(10) default NULL,','        "last_sync_success" VARCHAR(100) default NULL);',"DROP TABLE IF EXISTS object_values;","CREATE TABLE object_values (",'        "source_id" BIGINT default NULL,','        "attrib" varchar(255) default NULL,','        "object" varchar(255) default NULL,','        "value" varchar default NULL);',"DROP TABLE IF EXISTS changed_values;","CREATE TABLE changed_values (",'        "source_id" BIGINT default NULL,','        "attrib" varchar(255) default NULL,','        "object" varchar(255) default NULL,','        "value" varchar default NULL,','        "attrib_type" varchar(255) default NULL,','        "update_type" varchar(255) default NULL,','        "sent" BIGINT default 0);',"DROP TABLE IF EXISTS sources;","CREATE TABLE sources (",'        "source_id" BIGINT PRIMARY KEY,','        "name" VARCHAR(255) default NULL,','        "token" BIGINT default NULL,','        "sync_priority" BIGINT,','        "partition" VARCHAR(255),','        "sync_type" VARCHAR(255),','        "metadata" varchar default NULL,','        "last_updated" BIGINT default 0,','        "last_inserted_size" BIGINT default 0,','        "last_deleted_size" BIGINT default 0,','        "last_sync_duration" BIGINT default 0,','        "last_sync_success" BIGINT default 0,','        "backend_refresh_time" BIGINT default 0,','        "source_attribs" varchar default NULL,','        "schema" varchar default NULL,','        "schema_version" varchar default NULL,','        "associations" varchar default NULL,','        "blob_attribs" varchar default NULL);',"DROP INDEX IF EXISTS by_src_id;",'CREATE INDEX by_src_id on object_values ("source_id");',"DROP INDEX IF EXISTS by_src_object;",'CREATE UNIQUE INDEX by_src_object ON object_values ("object", "attrib", "source_id");',"DROP INDEX IF EXISTS by_src_value;",'CREATE INDEX by_src_value ON object_values ("attrib", "source_id", "value");'].join("\n");var i=function(l){return console.log(l)};var k=function(o){var n=[];var l=[];for(var m in o){if(o.hasOwnProperty(m)){n.push('"'+m+'"=?');l.push(o[m])}}return{clause:"set "+n.join(", "),values:l}};var g=function(q,p){var n=[];var l=[];for(var m in q){if(q.hasOwnProperty(m)){var o=q[m];if(o===null){n.push('"'+m+'" IS NULL')}else{n.push('"'+m+'"=?');l.push(o)}}}return{clause:"where "+n.join(" "+p+" "),values:l}};var j=function(n,s){var z=new Rho.Database(n,s);var t=function(){z.startTransaction()};var o=function(){z.commitTransaction()};var y=function(){z.rollbackTransaction()};var x=function(){z.lockDb()};var p=function(){z.unlockDb()};var w=function(A){return z.isTableExist(A)};var q=function(B,A){return z.executeSql(B,A)};var l=function(D,A){var C=z.executeSql(D,A);for(var B=0;B<C.length;++B){C[B]=Opal.hash2(C[B])}return C};var v=function(C,A,H){A=A.map;H=(H)?H.map:{};var F=[];var G=[];var E=[];for(var B in A){if(!A.hasOwnProperty(B)){continue}if(H.hasOwnProperty(B)){continue}F.push(B);G.push("?");if(typeof A[B]==="object"&&JSON.stringify(A[B]==="{}")){E.push(null)}else{E.push(A[B])}}var D='insert into "'+C+'" ("'+F.join('", "')+'") values ('+G.join(", ")+")";l(D,E)};var u=function(B,C){var A=g(C.map,"and");l('delete from "'+B+'" '+A.clause,A.values)};var m=function(D,C,G,F){var E=["select"];var A=[];if(F!==undefined&&F.distinct){E.push("distinct")}E.push('"'+C+'"');E.push('from "'+D+'"');if(G!==undefined){var B=g(G.map,"and");A=B.values;E.push(B.clause)}if(F!==undefined&&F["order by"]){E.push('order by "'+F["order by"]+'"')}return l(E.join(" "),A)};var r=function(D,A,F){var C=k(A.map);var E=['update "'+D+'"',C.clause];var A=C.values;if(F!==undefined){var B=g(F.map,"and");E.push(B.clause);A=A.concat(B.values)}return l(E.join(" "),A)};return{$start_transaction:t,$commit:o,$rollback:y,$lock_db:x,$unlock_db:p,$insert_into_table:v,$delete_from_table:u,$select_from_table:m,$update_into_table:r,$execute_sql:l,$is_table_exist:w,executeSql:q,isTableExist:w}};return{$new:j}})();(function(){var m=Opal,o=m.top,k=m,l=m.nil,h=m.breaker,i=m.slice,j=m.module,g=m.range,n=m.hash2;return(function(q){function p(){}p=j(q,"Rhom",p);var s=p.prototype,r=p._scope;(function(u){function t(){}t=j(u,"RhomObject",t);var w=t.prototype,v=t._scope;w.$strip_braces=function(x){if(x==null){x=l}if(x!==false&&x!==l){return x.$gsub(/\{/,"").$gsub(/\}/,"")}else{return l}};w.$djb_hash=function(A,x){var z=l,y;z=5381;this.$for(this.$i(this.$in(g(0,x,false))),(y=function(){var B=y._s||this;return z=z["$<<"](5)["$+"](z)["$+"](A["$[]"](B.$i()).$to_i())},y._s=this,y));return z};w.$extract_options=function(x){var y;if(x==null){x=[]}if((y=x.$last()["$is_a?"](v.Hash))!==false&&y!==l){return x.$pop()}else{return n({})}};(Opal.cvars["@@reserved_names"]=n({object:"1",source_id:"1",update_type:"1",attrib_type:"1",set_notification:"1",clear_notification:"1"}));v.RhomObject["$method_name_reserved?"]=function(y){var x;return((x=Opal.cvars["@@reserved_names"])==null?l:x)["$has_key?"](y)};t._donate(["$strip_braces","$djb_hash","$extract_options"])})(p)})(o)})();(function(){var n=Opal,p=n.top,l=n,m=n.nil,i=n.breaker,j=n.slice,k=n.module,g=n.klass,o=n.hash2,h=n.hash;return(function(r){function q(){}q=k(r,"Rhom",q);var t=q.prototype,s=q._scope;q["$any_model_changed?"]=function(){var u;var v=Rho.ORMHelper.getDbPartitions();f.each(v,function(A,y){var w=m,x=this,B,z;if(y==null){y=m}w=y.$execute_sql("SELECT object FROM changed_values LIMIT 1 OFFSET 0",[]);if(w.length>0){u=true}else{if(u!==true){u=m}}});if(u==true){return true}else{return false}};(function(u,y){function w(){}w=g(u,y,"RhomObjectFactory",w);w._sdonate(["$init_object"]);var x=w.prototype,v=w._scope;x.$initialize=function(){return m};w.$init_object=function(B){var A,z;if((A=v.Object["$const_defined?"](B.$intern()))!==false&&A!==m){return m}else{return v.Object.$const_set(B.$intern(),v.Class.$new((z=function(){var C=z._s||this,D=(C._isObject?C:C.prototype);C.$include((v.Rhom)._scope.RhomObject);C.$extend((v.Rhom)._scope.RhomObject);C.$attr_accessor("vars");D.$generate_id=function(){return(v.Rho)._scope.RhoConfig.$generate_id()};D.$initialize=function(H){var G,F,E;if(this.vars==null){this.vars=m}if(H==null){H=m}this.vars=o({});if((G=((F=H!==false&&H!==m)?H["$[]"]("object"):F))===false||G===m){this.$vars()["$[]="]("object",""+(this.$generate_id()))}this.$vars()["$[]="]("source_id",this.$get_inst_source_id().$to_i());if(H!==false&&H!==m){return H.$each((E=function(L,M){var I=E._s||this,K,J;if(L==null){L=m}if(M==null){M=m}if((K=((J=L!==false&&L!==m)?L.$length()["$>"](0):J))!==false&&K!==m){return I.$vars()["$[]="](L.$to_sym(),M)}else{return m}},E._s=this,E))}else{return m}};D.$object=function(){if(this.vars==null){this.vars=m}return this.vars["$[]"]("object")};D.$source_id=function(){if(this.vars==null){this.vars=m}return this.vars["$[]"]("source_id")};D.$to_s=function(){var E;if(this.vars==null){this.vars=m}if((E=this.vars)!==false&&E!==m){return this.vars.$to_s()}else{return m}};D.$to_json=function(E){var F;if(this.vars==null){this.vars=m}E=j.call(arguments,0);if((F=this.vars)!==false&&F!==m){return(F=this.vars).$to_json.apply(F,[].concat(E))}else{return m}};D.$method_missing=function(F,E){var G=m;if(this.vars==null){this.vars=m}E=j.call(arguments,1);if(F["$=="](v.Fixnum)){return m}else{if(F["$[]"](F.$length()["$-"](1))["$=="]("=")){G=F.$to_s().$chop();this.$check_freezing_model(G);return this.vars["$[]="](G.$to_sym(),E["$[]"](0))}else{return this.vars["$[]"](F)}}};D.$check_freezing_model=function(K){var L,I=m,H,G,F,E;L=this.$is_inst_schema_source();var J=(v.Rho)._scope.RhoConfig.$sources()["$[]"](this.$get_inst_source_name());if((K!==false&&K!==m)&&!L){H=J.freezed;if(H===undefined||!H){return m}}I=(L)?J.schema["property"]:J.property;if((H=K["$is_a?"](v.Hash))!==false&&H!==m){return K.$each((E=function(O,P){var M=E._s||this,N;if(O==null){O=m}if(P==null){P=m}if(O.$to_s()["$=="]("object")){return m}if(I["$[]"]===undefined){return m}alert(JSON.stringify(I));if((N=I["$[]"](O.$to_s()))!==false&&N!==m){return m}else{return M.$raise(v.ArgumentError.$new("Non-exist property : "+(O)+". For model : "+(M.$get_inst_source_name())))}},E._s=this,E))}else{if(I["$[]"]===undefined){return m}if((H=(G=K.$to_s()["$=="]("object"),(G===m||G===false)))!==false&&H!==m){if((H=I["$[]"](K.$to_s()))!==false&&H!==m){return m}else{return this.$raise(v.ArgumentError.$new("Non-exist property : "+(K)+". For model : "+(this.$get_inst_source_name())))}}else{return m}}};(function(){var E=C;E.$metadata=function(){var J=m,G=m,F=m,I,H;J=this.$get_source_name();if((I=(v.Rho)._scope.RhoController.$cached_metadata()["$has_key?"](J))!==false&&I!==m){return(v.Rho)._scope.RhoController.$cached_metadata()["$[]"](J)}G=(n.Object._scope.Rho)._scope.RHO.$get_src_db(J);F=G.$select_from_table("sources","metadata",o({name:J}));if((I=(H=((H=F!==false&&F!==m)?F.$length()["$>"](0):H),H!==false&&H!==m?F["$[]"](0)["$[]"]("metadata"):H))!==false&&I!==m){(v.Rho)._scope.RhoController.$cached_metadata()["$[]="](J,(v.Rho)._scope.JSON.$parse(F["$[]"](0)["$[]"]("metadata")))}else{(v.Rho)._scope.RhoController.$cached_metadata()["$[]="](J,m)}return(v.Rho)._scope.RhoController.$cached_metadata()["$[]"](J)};E["$metadata="]=function(H){var G=m,F=m;G=this.$get_source_name();F=(n.Object._scope.Rho)._scope.RHO.$get_src_db(G);return F.$execute_sql("UPDATE sources set metadata=? where name=?",[H,G])};E.$count=function(){var G=m,F=m,J=m,I,H;G=(n.Object._scope.Rho)._scope.RHO.$get_src_db(this.$get_source_name());if((I=this.$is_schema_source())!==false&&I!==m){F=G.$execute_sql("SELECT COUNT(*) FROM "["$+"](this.$get_schema_table_name()),[]);if((I=((H=F!==false&&F!==m)?F.$length()["$>"](0):H))!==false&&I!==m){J=F["$[]"](0).$values()["$[]"](0)}else{J=0}}else{J=G.$select_from_table("object_values","object",o({source_id:this.$get_source_id()}),{distinct:true}).$length()}return J.$to_i()};E.$backend_refresh_time=function(){var G=m,F=m,J=m,I,H;G=(n.Object._scope.Rho)._scope.RHO.$get_src_db(this.$get_source_name());F=G.$select_from_table("sources","backend_refresh_time",o({source_id:this.$get_source_id()}));J=0;if((I=(H=((H=F!==false&&F!==m)?F.$length()["$>"](0):H),H!==false&&H!==m?F["$[]"](0)["$[]"]("backend_refresh_time"):H))!==false&&I!==m){J=F["$[]"](0)["$[]"]("backend_refresh_time").$to_i()}return v.Time.$at(J)};E.$get_source_name=function(){return this.$name().$to_s()};E.$is_sync_source=function(){var F=(v.Rho)._scope.RhoConfig.$sources()["$[]"](this.$get_source_name());return F.sync_type!=="none"};E.$is_schema_source=function(){var F=(v.Rho)._scope.RhoConfig.$sources()["$[]"](this.$get_source_name());return F.hasOwnProperty("schema")};E.$get_schema_table_name=function(){return this.$get_source_name()};E.$get_values_table_name=function(){var F;if((F=this.$is_schema_source())!==false&&F!==m){return this.$get_schema_table_name()}else{return"object_values"}};E.$get_source_id=function(){var F=(v.Rho)._scope.RhoConfig.$sources()["$[]"](this.$get_source_name());return F.source_id};E.$convertOpToStr=function(L,M){var H=m,F=m,K,J,I,G;H="";if((K=((J=L.$upcase()["$=="]("IN")),J!==false&&J!==m?J:L.$upcase()["$=="]("NOT IN")))!==false&&K!==m){if((K=M["$is_a?"](v.String))!==false&&K!==m){M=M.$split(",");M.$each((I=function(S){var P=I._s||this,R,Q,O;if(S==null){S=m}S["$strip!"]();if((R=((Q=(O=S["$start_with?"]('"'),O!==false&&O!==m?S["$end_with?"]('"'):O)),Q!==false&&Q!==m?Q:(O=S["$start_with?"]("'"),O!==false&&O!==m?S["$end_with?"]("'"):O)))!==false&&R!==m){S["$slice!"](0);return S["$chop!"]()}else{return m}},I._s=this,I))}if((K=M["$is_a?"](v.Array))!==false&&K!==m){F="";M.$each((G=function(P){var O=G._s||this;if(P==null){P=m}if(F.$length()["$>"](0)){F=F["$+"](",")}return F=F["$+"]("'"+(P)+"'")},G._s=this,G));H=H["$+"](L["$+"](" ( ")["$+"](F)["$+"](" )"))}else{this.$raise(v.ArgumentError,"IN parameters should be String or Array")}}else{var N=Rho.ORMHelper.getValueForSqlStmt(M,false);H=H["$+"](L["$+"](" ")["$+"](N))}return H};E.$convertSqlConditionToStr=function(I,K){var G=m,H,F,J;if((H=I["$is_a?"](v.String))!==false&&H!==m){return I}if((H=(F=I["$is_a?"](v.Array),F!==false&&F!==m?(F=K,(F===m||F===false)):F))!==false&&H!==m){G=I["$[]"](0).$split(/\?/).$each_with_index((J=function(N,M){var L=J._s||this;if(N==null){N=m}if(M==null){M=m}return N["$<<"](I["$[]"](M["$+"](1)).$to_s())},J._s=this,J)).$join(" ").$to_s();this.$puts("condition_str : "+(G));return G}return m};E.$convertConditionToStatement=function(N,K,R,P){var L=m,I=m,G=m,F=m,Q=m,O,J,M,H;if((O=N["$is_a?"](v.Array))!==false&&O!==m){if((O=K)===false||O===m){return m}L="";I=[];N.$each((J=function(U){var V=m,S=m,T=J._s||this;if(U==null){U=m}if(L.$length()["$>"](0)){L=L["$+"](" "["$+"](K)["$+"](" "))}V="";S=[];T.$convertConditionToStatement(U["$[]"]("conditions"),U["$[]"]("op"),V,S);L["$<<"]("("["$+"](V)["$+"](")"));return I.$concat(S)},J._s=this,J));R["$<<"](L);P.$concat(I);return m}if((O=(M=N["$is_a?"](v.Hash),(M===m||M===false)))!==false&&O!==m){return m}G=true;if((O=K)===false||O===m){K="AND"}N.$each((H=function(W,X){var Y=m,S=m,T=H._s||this,V,U;if(W==null){W=m}if(X==null){X=m}if((V=W["$is_a?"](v.Hash))!==false&&V!==m){((V=T.$makeCondWhereEx(W,X,m))._isArray?V:(V=[V])),Y=(V[0]==null?m:V[0]),S=(V[1]==null?m:V[1]);if((V=(U=G,(U===m||U===false)))!==false&&V!==m){R["$<<"](" "["$+"](K)["$+"](" "))}R["$<<"](Y);P.$concat(S);return G=false}else{return m}},H._s=this,H));if(G!==false&&G!==m){((O=(n.Object._scope.Rhom)._scope.RhomDbAdapter.$make_where_params(N,"AND"))._isArray?O:(O=[O])),F=(O[0]==null?m:O[0]),Q=(O[1]==null?m:O[1]);R["$<<"](F);return P.$concat(Q)}else{return m}};E.$makeCondWhere=function(J,L,H){var M=m,G=m,K=m,F=m,I;M=[];G="=";K="";F="";if((I=J["$is_a?"](v.Hash))!==false&&I!==m){if((I=J["$[]"]("op"))!==false&&I!==m){G=J["$[]"]("op")}if((I=J["$[]"]("func"))!==false&&I!==m){K=J["$[]"]("func")}if((I=J["$[]"]("name"))!==false&&I!==m){F=J["$[]"]("name")}}else{F=J}M["$<<"]("attrib="["$+"](Rho.ORMHelper.getValueForSqlStmt((function(){if(K.$upcase()["$=="]("CAST")){return F.$split(" ")["$[]"](0)}else{return F}return m}).call(this))));M["$<<"](" AND source_id="["$+"](H));if(K.$upcase()["$=="]("CAST")){M["$<<"](" AND "["$+"](K)["$+"]("(value ")["$+"](F.$split(" ")["$[]"](1))["$+"](" ")["$+"](F.$split(" ")["$[]"](2))["$+"](" ) "))}else{M["$<<"](" AND "["$+"]((function(){if(K.$length()["$>"](0)){return K["$+"]("(value)")}else{return"value"}return m}).call(this))["$+"](" "))}M["$<<"](this.$convertOpToStr(G,L));return M};E.$getCondAttribName=function(H){var F=m,G;if((G=H["$is_a?"](v.Hash))!==false&&G!==m){if((G=H["$[]"]("name"))!==false&&G!==m){F=H["$[]"]("name")}}else{F=H}return F};E.$makeCondWhereEx=function(O,M,N){var P=m,I=m,J=m,F=m,K=m,H,G,L;P="";I=[];J="=";F="";K="";if((H=O["$is_a?"](v.Hash))!==false&&H!==m){if((H=O["$[]"]("op"))!==false&&H!==m){J=O["$[]"]("op")}if((H=O["$[]"]("func"))!==false&&H!==m){F=O["$[]"]("func")}if((H=O["$[]"]("name"))!==false&&H!==m){K=O["$[]"]("name")}}else{K=O}if((H=N["$nil?"]())!==false&&H!==m){P+=(function(){if(F.$length()["$>"](0)){return F["$+"]("("+(K)+")")}else{return""+K}}).call(this)["$+"](" ")}else{if((H=(G=K["$is_a?"](v.String),G!==false&&G!==m?K["$=="]("object"):G))!==false&&H!==m){P+=" source_id=?";I["$<<"](N);P+=" AND object "}else{P+="attrib=?";I["$<<"]((function(){if(F.$upcase()["$=="]("CAST")){return K.$split(" ")["$[]"](0)}else{return K}return m}).call(this));P+=" AND source_id=?";I["$<<"](N);if(F.$upcase()["$=="]("CAST")){P+=" AND "["$+"](F)["$+"]("(value ")["$+"](K.$split(" ")["$[]"](1))["$+"](" ")["$+"](K.$split(" ")["$[]"](2))["$+"](" ) ")}else{P+=" AND "+(function(){if(F.$length()["$>"](0)){return F["$+"]("(value)")}return"value"}).call(this)+" "}}}if((H=((G=J.$upcase()["$=="]("IN")),G!==false&&G!==m?G:J.$upcase()["$=="]("NOT IN")))!==false&&H!==m){if((H=M["$is_a?"](v.String))!==false&&H!==m){M=M.$split(",");M.$each((L=function(T){var Q=L._s||this,S,R;if(T==null){T=m}T["$strip!"]();if((S=(R=T["$start_with?"]('"'),R!==false&&R!==m?T["$end_with?"]('"'):R))!==false&&S!==m){T["$slice!"](0);return T["$chop!"]()}else{return m}},L._s=this,L))}if((H=M["$is_a?"](v.Array))!==false&&H!==m){P+=J["$+"](" ( "+(v.Array.$new(M.$length(),"?").$join(","))+" )");I.$concat(M)}else{this.$raise(v.ArgumentError,"IN parameters should be String or Array")}}else{P+=J["$+"](" ?");I["$<<"](M)}return[P,I]};E.$find_objects=function(W,O,aa,L,P,N){var R=function(af){var ah=0;for(var ag in af){if(af.hasOwnProperty(ag)){++ah}}return ah};var G=function(af,ah){for(var ag in af){if(af.hasOwnProperty(ag)){ah(ag,af[ag])}}};var ac={},Z=m,ad=m,T=m,F=m,ab=m,K=m,Y=m,Q=m,M=m,ae=m,X,J,I,H,V,U,S;if(typeof(N)!=="function"){N=m}if(O==="AND"){G(W,function(af,ag){if(ag===null){ac[af]=ag;delete W[af]}})}Z=m;if(N===m&&P===undefined){if(aa!==undefined&&L!==undefined&&R(W)<=1&&R(ac)===0){Z=" LIMIT "["$+"](aa.$to_s())["$+"](" OFFSET ")["$+"](L.$to_s())}}ad=(n.Object._scope.Rho)._scope.RHO.$get_src_db(this.$get_source_name());T=[];if((J=((I=O["$=="]("OR"))?R(W)>1:I))!==false&&J!==m){F=Rho.ORMHelper.getValueForSqlStmt(this.$get_source_id());ab=o({});K=false;G(W,(V=function(ai,aj){var ak=m,ah=m,af=V._s||this,ag;if(ai==null){ai=m}if(aj==null){aj=m}ak=[];ak["$<<"]("SELECT object,attrib,value FROM object_values WHERE \n");ak["$<<"](af.$makeCondWhere(ai,aj,F));ah=ad.$execute_sql(ak,[]);ah.$each((ag=function(ao){var al=ag._s||this,an,am;if(ao==null){ao=m}if((an=ab["$[]"](ao["$[]"]("object")))!==false&&an!==m){return m}ab["$[]="](ao["$[]"]("object"),1);T["$<<"](ao);if(P===undefined&&aa!==undefined&&L!==undefined&&R(ac)===0&&T.length>=L+aa){return(i.$v=m,i)}return m},ag._s=af,ag));if(K!==false&&K!==m){return(i.$v=m,i)}else{return m}},V._s=this,V))}else{if(R(W)>0){Y="";Q=[];G(W,(U=function(aj,al){var af=m,am=m,ak=m,ag=U._s||this,ai,ah;if(aj==null){aj=m}if(al==null){al=m}if(Y.length>0){Y+="\nINTERSECT\n"}af=ag.$getCondAttribName(aj);if((ai=(ah=((ah=af!==false&&af!==m)?af["$is_a?"](v.String):ah),ah!==false&&ah!==m?af["$=="]("object"):ah))!==false&&ai!==m){Y+="SELECT DISTINCT(object) FROM object_values WHERE \n"}else{Y+="SELECT object FROM object_values WHERE \n"}((ai=ag.$makeCondWhereEx(aj,al,ag.$get_source_id()))._isArray?ai:(ai=[ai])),am=(ai[0]==null?m:ai[0]),ak=(ai[1]==null?m:ai[1]);Y+=am;Q=Q["$+"](ak);if(Z!==false&&Z!==m){Y+=Z}},U._s=this,U));T=ad.$execute_sql(Y,Q)}else{Y="";Q=[];Y+="SELECT distinct( object ) FROM object_values WHERE \n";Y+="source_id=?";Q["$<<"](this.$get_source_id());if(Z!==false&&Z!==m){Y+=Z}T=ad.$execute_sql(Y,Q)}}M=-1;ae=[];T.$each((S=function(al){var ak=m,ah=S._s||this,aj,ai,ag,af;if(al==null){al=m}M=M["$+"](1);if(P===undefined&&L!==undefined&&M<L&&(Z===m||Z===false)){return m}ak=false;G(ac,(af=function(aq,ar){var ao=m,am=af._s||this,ap,an;if(aq==null){aq=m}if(ar==null){ar=m}Y="";Y["$<<"]("SELECT value FROM object_values WHERE \n");Y["$<<"]("object=?");Y["$<<"](" AND attrib=?");Y["$<<"](" AND source_id=?");ao=ad.$execute_sql(Y,[al["$[]"]("object"),aq,am.$get_source_id()]);if((ap=(an=((an=ao!==false&&ao!==m)?ao.$length()["$>"](0):an),an!==false&&an!==m?ao["$[]"](0)["$[]"]("value"):an))!==false&&ap!==m){ak=true;return(i.$v=m,i)}else{return m}},af._s=ah,af));if(ak!==false&&ak!==m){return m}return ae["$<<"](al)},S._s=this,S));return ae};E.$find_objects_ex=function(N,L,I,J,G,H){var M=m,F=m,K;if(typeof(H)!=="function"){H=m}M=o({});F=[];N.$each((K=function(R){var Q=m,O=m,P=K._s||this,U,T,S;if(R==null){R=m}Q=P.$find_objects(R["$[]"]("conditions"),R["$[]"]("op"),I,J,G,H.$to_proc());if(F.$length()["$=="](0)){if(N.$length()["$>"](1)){Q.$each((U=function(W){var V=U._s||this;if(W==null){W=m}return M["$[]="](W["$[]"]("object"),1)},U._s=P,U))}return F=Q}else{if(L["$=="]("OR")){return Q.$each((T=function(X){var Z=m,V=T._s||this,Y,W;if(X==null){X=m}Z=X["$[]"]("object");if((Y=(W=M["$has_key?"](Z),(W===m||W===false)))!==false&&Y!==m){F["$<<"](X);return M["$[]="](Z,1)}else{return m}},T._s=P,T))}else{O=[];Q.$each((S=function(W){var Y=m,V=S._s||this,X;if(W==null){W=m}Y=W["$[]"]("object");if((X=M["$has_key?"](Y))!==false&&X!==m){return O["$<<"](W)}else{return m}},S._s=P,S));return F=O}}},K._s=this,K));return F};E.$find_bycondhash=function(G,O){var V=undefined,N=undefined,X=undefined,L=undefined,Y=undefined,H=m,P=m,S=m,Q=undefined,R=m,T=m,Z=m,U=m,M=m,K,F,J;if(typeof(O)!=="function"){O=m}V={};N=undefined;X=undefined;L=0;Y="";H=[];P="AND";S=this.$get_source_id().$to_i();var W=G[0];var I=G[1];if(I!==undefined){if(I.conditions!==undefined){V=I.conditions}if(I.per_page!==undefined){X=I.per_page.$to_i();L=(I.offset===undefined)?0:I.offset.$to_i()}if(I.select!==undefined){N=I.select}Y=I.orderdir;Q=I.order;if(I.op!==undefined){P=I.op.$upcase()}}if(W==="first"){X=1;if(L===undefined){L=0}}R=m;if(N!==undefined){R=N;if(Q!==undefined){T=[];if((K=Q["$is_a?"](v.Array))!==false&&K!==m){T=Q}else{T.$push(Q)}R=R["$|"](T)}}Z=(n.Object._scope.Rho)._scope.RHO.$get_src_db(this.$get_source_name());Z.$lock_db();try{U=[];if(V instanceof Array){U=this.$find_objects_ex(V,P,X,L,Q,O.$to_proc())}else{U=this.$find_objects(V,P,X,L,Q,O.$to_proc())}M=0;if(W==="count"){M=U.$length()}else{U.$each((F=function(ac){var ah=m,aa=m,ag=m,ai=F._s||this,ab,af,ae,ad;if(ac==null){ac=m}aa=Z.$execute_sql("SELECT attrib,value FROM object_values WHERE object=? AND source_id=?",[ac["$[]"]("object"),ai.$get_source_id()]);ag=ai.$new(o({object:""+(ac["$[]"]("object"))}));aa.$each((ab=function(al){var ap=m,an=m,ak=ab._s||this,ao,am,aj;if(al==null){al=m}ap=al["$[]"]("attrib");an=al["$[]"]("value");if((ao=((am=R!==false&&R!==m)?(aj=R["$=="]("*"),(aj===m||aj===false)):am))!==false&&ao!==m){if((ao=R["$include?"](ap))===false||ao===m){return m}}if(an!==false&&an!==m){return ag.$vars()["$[]="](ap.$to_sym(),an)}else{return m}},ab._s=ai,ab));H["$<<"](ag);if(Q===undefined&&X!==undefined&&H.length>=X){return(i.$v=m,i)}return m},F._s=this,F))}}finally{Z.$unlock_db()}this.$order_array(H,Q,Y,O.$to_proc());if((O!==m||Q!==undefined)&&X!==undefined){H=H.$slice(L,X)}if(W==="count"){return M}if(W==="first"){return(function(){if(H.$length()["$>"](0)){return H["$[]"](0)}else{return m}return m}).call(this)}return H};E.$order_array=function(F,I,H,K){var J,G;if(typeof(K)!=="function"){K=m}if(I!==undefined){return F["$sort!"]((J=function(S,P){var M=m,Q=m,O=m,T=J._s||this,R,L,N;if(S==null){S=m}if(P==null){P=m}M=0;if((R=I["$is_a?"](v.Array))!==false&&R!==m){I.$each_index((L=function(Z){var aa=m,Y=m,W=m,U=L._s||this,X,V;if(Z==null){Z=m}aa=S.$vars()["$[]"](I["$[]"](Z).$to_sym());Y=P.$vars()["$[]"](I["$[]"](Z).$to_sym());M=((aa!==false&&aa!==m)&&(Y!==false&&Y!==m))?aa["$<=>"](Y):0;W="ASC";if((X=(V=(H!==undefined&&H["$is_a?"](v.Array)),V?Z["$<"](H.$length()):V))!==false&&X!==m){W=H["$[]"](Z).$upcase()}else{if(H!==undefined&&H["$is_a?"](v.String)){W=H.$upcase()}}if((X=((V=W!==false&&W!==m)?W["$=="]("DESC"):V))!==false&&X!==m){M=M["$*"](-1)}if((X=(V=M["$=="](0),(V===m||V===false)))!==false&&X!==m){return(i.$v=m,i)}else{return m}},L._s=T,L))}else{Q=S.$vars()["$[]"](I.$to_sym());O=P.$vars()["$[]"](I.$to_sym());M=((Q!==false&&Q!==m)&&(O!==false&&O!==m))?Q["$<=>"](O):0;if(H!==undefined&&H.$upcase()["$=="]("DESC")){M=M["$*"](-1)}}return M},J._s=this,J))}else{if((K!==m)){return F["$sort!"]((G=function(L,Q){var P=m,M=G._s||this,O,N;if(L==null){L=m}if(Q==null){Q=m}P=(((O=__yield(L,Q))===i)?i.$v:O);if(H!==undefined&&H.$upcase()["$=="]("DESC")){P=P["$*"](-1)}return P},G._s=this,G))}else{return m}}};E.$make_sql_order=function(L){var K=m,J=m,I=m,H,G,F;K=L["$[]"]("order");J=L["$[]"]("orderdir");I="";if((H=((G=K!==false&&K!==m)?K["$is_a?"](v.Array):G))!==false&&H!==m){K.$each_index((F=function(P){var M=F._s||this,O,N;if(P==null){P=m}if(P["$>"](0)){I=I["$+"](",")}I=I["$+"]('"'+(K["$[]"](P))+'" ');if((O=(N=((N=J!==false&&J!==m)?J["$is_a?"](v.Array):N),N!==false&&N!==m?P["$<"](J.$length()):N))!==false&&O!==m){return I=I["$+"](J["$[]"](P).$upcase())}else{return I=I["$+"]((function(){if((O=((N=J!==false&&J!==m)?J["$is_a?"](v.String):N))!==false&&O!==m){return J.$upcase()}else{return"ASC"}return m}).call(M))}},F._s=this,F))}else{I=('"'+(K)+'" ')["$+"]((function(){if(J!==false&&J!==m){return J.$upcase()}else{return""}return m}).call(this))}return I};E.$find=function(J,U){var K=m,N=m,ag=undefined,S=undefined,T=undefined,I=m,ah=undefined,ab=m,W=undefined,ae=m,aa=m,L=m,ac=m,af=m,ak=m,G=m,H=m,F=m,Z=m,aj=m,R,Q,P,O,al,ai,Y,X,U;J=j.call(arguments,0);if(typeof(J[J.length-1])==="function"){U=J.pop()}else{U=m}if((R=((Q=J["$[]"](0)["$nil?"]()),Q!==false&&Q!==m?Q:J.$length()["$=="](0)))!==false&&R!==m){((this.$raise())._scope.Rhom)._scope.RecordNotFound}K=[];N=m;ag=undefined;S=undefined;var ad=J["$[]"](0);var M=J["$[]"](1);if(ad==="all"||ad==="first"||ad==="count"){if((R=(Q=this.$is_schema_source(),(Q===m||Q===false)))!==false&&R!==m){if(M!==undefined&&M.conditions!==undefined){if(M.conditions instanceof Object){return this.$find_bycondhash(J,U.$to_proc())}if((M.conditions instanceof Array)&&M.op!==undefined){return this.$find_bycondhash(J,U.$to_proc())}}N=o({source_id:this.$get_source_id()})}}else{if((R=J.$first()["$is_a?"](v.String))!==false&&R!==m){if((R=(Q=this.$is_schema_source(),(Q===m||Q===false)))!==false&&R!==m){N=o({object:this.$strip_braces(J.$first().$to_s()),source_id:this.$get_source_id()})}else{N=o({object:this.$strip_braces(J.$first().$to_s())})}ag=1;S=0}}if((R=((Q=J.$first()["$=="]("count"))?(P=J["$[]"](1),(P===m||P===false)):Q))!==false&&R!==m){return this.$count()}T=undefined;I=m;ah="";ab=this.$get_source_id().$to_i();if(M!==undefined){if(M.conditions!==undefined){I=this.$convertSqlConditionToStr(M.conditions,M.op)}if(M.per_page!==undefined){ag=M.per_page.$to_i();S=(M.offset===undefined)?0:M.offset.$to_i()}if(M.select!==undefined){T=M.select}ah=M.orderdir;W=M.order}if(J.$first()["$=="]("first")){ag=1;if(S===undefined){S=0}}ae=m;if((R=(Q=(U!==m),(Q===m||Q===false)))!==false&&R!==m){if(ag!==undefined&&S!==undefined){ae=" LIMIT "["$+"](ag.$to_s())["$+"](" OFFSET ")["$+"](S.$to_s())}}if(T!==undefined){aa=T}else{aa="*"}L=false;if((R=((Q=aa!==false&&aa!==m)?aa.$length()["$>"](0):Q))!==false&&R!==m){ac="";af=[];ak=(n.Object._scope.Rho)._scope.RHO.$get_src_db(this.$get_source_name());if((R=(Q=this.$is_schema_source(),(Q===m||Q===false)))!==false&&R!==m){G=m;if((R=(Q=I,(Q===m||Q===false)))!==false&&R!==m){H=[];if((R=(Q=J.$first()["$is_a?"](v.String),Q!==false&&Q!==m?(Q=((P=((O=J.$first()["$=="]("all")),O!==false&&O!==m?O:J.$first()["$=="]("first"))),P!==false&&P!==m?P:J.$first()["$=="]("count")),(Q===m||Q===false)):Q))!==false&&R!==m){G=[o({object:this.$strip_braces(J.$first().$to_s())})]}else{if(U===m&&W!==undefined&&typeof W=="string"){if((R=(Q=J["$[]"](1)["$[]"]("dont_ignore_missed_attribs"),(Q===m||Q===false)))!==false&&R!==m){ac+="SELECT object FROM object_values WHERE source_id=? ";ac+=' AND attrib=? ORDER BY "value" '+((ah!==undefined)?ah:"");H["$<<"](ab);H["$<<"](W)}}else{if((R=(Q=(Q=((Q=aa!==false&&aa!==m)?(P=aa["$=="]("*"),(P===m||P===false)):Q),Q!==false&&Q!==m?(Q=aa.$length()["$=="](0),(Q===m||Q===false)):Q),Q!==false&&Q!==m?(Q=J["$[]"](1)["$[]"]("dont_ignore_missed_attribs"),(Q===m||Q===false)):Q))!==false&&R!==m){ac+=("SELECT object FROM object_values WHERE attrib=? AND source_id=?");H["$<<"](aa["$[]"](0));H["$<<"](ab)}else{if(ag===1&&S===0){ac="SELECT object FROM object_values WHERE source_id=?";H["$<<"](ab)}else{if(ae!==false&&ae!==m){ac="SELECT distinct(object) FROM object_values WHERE source_id=?";H["$<<"](ab)}}}L=W!==undefined}if(ac.$length()["$>"](0)){if(ae!==false&&ae!==m){ac+=(ae)}G=ak.$execute_sql(ac,H)}}if(G!==false&&G!==m){G.$each((al=function(ao){var av=m,au=m,at=m,ap=m,an=m,aw=al._s||this,ar,aq,am;if(ao==null){ao=m}av=ao["$[]"]("object");au="SELECT attrib,value FROM object_values WHERE object=? AND source_id=?";at=[];at["$<<"](av);at["$<<"](ab);ap=ak.$execute_sql(au,at);if((ar=((aq=ap!==false&&ap!==m)?ap.$length()["$>"](0):aq))!==false&&ar!==m){an=o({object:av});ap.$each((am=function(aB){var ay=am._s||this,aA,az,ax;if(aB==null){aB=m}if((aA=((az=aa!==false&&aa!==m)?(ax=aa["$=="]("*"),(ax===m||ax===false)):az))!==false&&aA!==m){if((aA=aa["$include?"](aB["$[]"]("attrib")))===false||aA===m){return m}}return an["$[]="](aB["$[]"]("attrib"),aB["$[]"]("value"))},am._s=aw,am));return af["$<<"](an)}else{return m}},al._s=this,al))}}if((R=G["$nil?"]())!==false&&R!==m){if((I===m||I===false)&&(M===undefined||M.dont_ignore_missed_attribs===undefined)){ac="SELECT object, attrib, value FROM object_values WHERE source_id=? order by object";H=[ab];G=ak.$execute_sql(ac,H);F=m;G.$each((ai=function(aq){var an=ai._s||this,ap,ao,am;if(aq==null){aq=m}if((ap=((ao=(am=F,(am===m||am===false))),ao!==false&&ao!==m?ao:(am=F["$[]"]("object")["$=="](aq["$[]"]("object")),(am===m||am===false))))!==false&&ap!==m){if(F!==false&&F!==m){af["$<<"](F)}F=o({object:aq["$[]"]("object")})}if((ap=aq["$[]"]("value"))!==false&&ap!==m){return F["$[]="](aq["$[]"]("attrib"),aq["$[]"]("value"))}else{return m}},ai._s=this,ai));if(F!==false&&F!==m){af["$<<"](F)}L=W!==undefined}else{if(aa["$=="]("*")){this.$raise(v.ArgumentError,"Use Rhom advanced find syntax or specify :select parameter when use sql queries!")}if((R=((Q=aa!==false&&aa!==m)?aa.$length()["$>"](0):Q))!==false&&R!==m){if(I!==false&&I!==m){ac+=("SELECT * FROM (\n")}ac+=("SELECT object, \n");aa.$each((Y=function(aq){var an=Y._s||this,ap,ao,am;if(aq==null){aq=m}if((ap=((ao=((am=aq["$nil?"]()),am!==false&&am!==m?am:aq.$length()["$=="](0))),ao!==false&&ao!==m?ao:(n.Object._scope.Rhom)._scope.RhomObject["$method_name_reserved?"](aq)))!==false&&ap!==m){return m}else{return ac+=("MAX(CASE WHEN attrib = '"+(aq)+"' THEN value ELSE NULL END) AS '"+(aq)+"',\n")}},Y._s=this,Y));ac["$chomp!"]();ac["$chop!"]();ac+=(" FROM object_values ov \n");if((R=((Q=N!==false&&N!==m)?N.$length()["$>"](0):Q))!==false&&R!==m){ac+=("where "["$+"](Rho.ORMHelper.whereStr(N))["$+"]("\n"))}ac+=("group by object\n");if(U===m&&W!==undefined){ac+=("order by "["$+"](this.$make_sql_order(J["$[]"](1))))}if(I!==false&&I!==m){ac+=(") WHERE "["$+"](I))}if(ae!==false&&ae!==m){ac+=(ae)}af=ak.$execute_sql(ac,[])}}}}else{if((R=aa["$is_a?"](v.Array))!==false&&R!==m){aa=aa.$join(",")}ac+=("SELECT "+(aa)+" FROM "+(this.$get_schema_table_name()));Z=[];if((R=((Q=N!==false&&N!==m)?N.$length()["$>"](0):Q))!==false&&R!==m){ac+=(" WHERE "["$+"](Rho.ORMHelper.whereStr(N)))}else{if(I!==false&&I!==m){ac+=(" WHERE "["$+"](I))}else{var V=true;if(J["$[]"](1)===undefined||J["$[]"](1)["$[]"]===undefined){V=false}if(V&&J["$[]"](1)["$[]"]===undefined){V=false}if(V&&J["$[]"](1)["$[]"]("conditions")===undefined){V=false}if(V){if((R=(Q=J["$[]"](1),Q!==false&&Q!==m&&Q!==undefined?J["$[]"](1)["$[]"]("conditions"):Q))!==false&&R!==m){aj="";this.$convertConditionToStatement(J["$[]"](1)["$[]"]("conditions"),J["$[]"](1)["$[]"]("op"),aj,Z);if(aj.$length()["$>"](0)){ac+=(" WHERE "["$+"](aj))}}}}}if(U===m&&W!==undefined){ac+=" order by "["$+"](this.$make_sql_order(J["$[]"](1)))}if(ae!==false&&ae!==m){ac+=(ae)}af=ak.$execute_sql(ac,Z)}if((R=(Q=J.$first()["$=="]("count"),(Q===m||Q===false)))!==false&&R!==m){af.$each((X=function(am){var ap=m,an=X._s||this,ao;if(am==null){am=m}ap=an.$new(o({object:""+(am["$[]"]("object"))}));am.$each((ao=function(at,ar){var aq=ao._s||this;if(at==null){at=m}if(ar==null){ar=m}if(ar!==false&&ar!==m){return ap.$vars()["$merge!"](h(at.$to_sym(),ar))}else{return m}},ao._s=an,ao));return K["$<<"](ap)},X._s=this,X))}}else{this.$puts("Processing rhom objects end, no attributes found.")}if((R=((Q=(U!==m)),Q!==false&&Q!==m?Q:L))!==false&&R!==m){this.$order_array(K,W,ah,U.$to_proc());if(ag!==undefined){K=K.$slice(S,ag)}}if(J.$first()["$=="]("count")){return af.$length()}if(J.$first()["$=="]("all")){return K}if((R=((Q=J.$first()["$=="]("first")),Q!==false&&Q!==m?Q:J.$first()["$is_a?"](v.String)))!==false&&R!==m){return(function(){if(K.$length()["$>"](0)){return K["$[]"](0)}else{return m}return m}).call(this)}return K};E.$find_by_sql=function(L){var G=m,J=m,F=m,I,H,K;if((I=(H=this.$is_schema_source(),(H===m||H===false)))!==false&&I!==m){this.$raise(v.ArgumentError,"find_by_sql only works with FixedSchema models")}G=(n.Object._scope.Rho)._scope.RHO.$get_src_db(this.$get_source_name());J=G.$execute_sql(L,[]);F=[];J.$each((K=function(M){var P=m,N=K._s||this,O;if(M==null){M=m}P=N.$new(o({object:""+(M["$[]"]("object"))}));M.$each((O=function(S,R){var Q=O._s||this;if(S==null){S=m}if(R==null){R=m}if(R!==false&&R!==m){return P.$vars()["$merge!"](h(S.$to_sym(),R))}else{return m}},O._s=N,O));return F["$<<"](P)},K._s=this,K));return F};E.$search=function(F){var G;if((G=true)!==false&&G!==m){F["$[]="]("source_names",[this.$name().$to_s()]);return v.SyncEngine.$search(F)}else{return m}};E.$sync=function(H,G,F){if(typeof d!=="undefined"&&typeof d.RhoConnectClient!=="undefined"){if(H!==undefined){d.RhoConnectClient.setNotification(this.$get_source_name(),H)}return d.RhoConnectClient.doSyncSource(this.$get_source_id().$to_i(),(G===undefined)||G,(F===undefined)?"":F)}};E.$find_all=function(F){if(F==null){F=m}return this.$find("all",F)};E.$paginate=function(F){if(F==null){F=m}"FIXME(op_asgn1)";"FIXME(op_asgn1)";F["$[]="]("offset",F["$[]"]("page")["$*"](F["$[]"]("per_page")));return this.$find("all",F)};E.$set_notification=function(F,H){var G;if((G=true)!==false&&G!==m){return v.SyncEngine.$set_notification(this.$get_source_id().$to_i(),F,H)}else{return m}};E.$clear_notification=function(){var F;if((F=true)!==false&&F!==m){return v.SyncEngine.$clear_notification(this.$get_source_id().$to_i())}else{return m}};E.$is_blob_attrib=function(H,F,G){console.log("inside is blob function");return d.Database.SQLite3.isBlobAttr(H,F.$to_i(),G)};E.$on_sync_delete_error=function(M,H){var G=m,I=m,N=m,J=m,K,L;if((K=true)!==false&&K!==m){if((K=H["$=="]("retry"))===false||K===m){this.$raise(v.ArgumentError,"on_sync_delete_error action should be :retry")}if(!this.$is_sync_source()){return m}G=this.$get_source_id();var F=(v.Rho)._scope.RhoConfig.$sources()["$[]"](this.$get_source_name());I=F.partition;N=(n.Object._scope.Rho)._scope.RHO.$get_src_db(this.$get_source_name());N.$start_transaction();return(function(){try{M.$each((L=function(S,Q){var P=L._s||this,R;if(S==null){S=m}if(Q==null){Q=m}return Q["$[]"]("attributes").$each((R=function(Z,Y){var X=m,V=m,T=R._s||this,W,U;if(Z==null){Z=m}if(Y==null){Y=m}X=N.$select_from_table("changed_values","update_type",o({object:S,source_id:G,attrib:Z,sent:0}));if((W=((U=X!==false&&X!==m)?X.$length()["$>"](0):U))!==false&&W!==m){return m}V=(function(){if((W=T.$is_blob_attrib(I,G,Z))!==false&&W!==m){return"blob.file"}else{return""}return m}).call(T);return N.$insert_into_table("changed_values",o({source_id:G,object:S,attrib:Z,value:Y,update_type:"delete",attrib_type:V}))},R._s=P,R))},L._s=this,L));N.$commit()}catch(O){if(v.Exception["$==="](O)){J=O;this.$puts("on_sync_delete_error Exception: "["$+"](J.$inspect()));N.$rollback();this.$raise()}else{throw O}}}).call(this)}else{return m}};E.$on_sync_update_error=function(Q,H,K){var G=m,I=m,J=m,R=m,L=m,O,N,P,M;if(K==null){K=m}if((O=true)!==false&&O!==m){if((O=((N=H["$=="]("retry")),N!==false&&N!==m?N:H["$=="]("rollback")))===false||O===m){this.$raise(v.ArgumentError,"on_sync_update_error action should be :retry or :rollback")}if((O=this.$is_sync_source())===false||O===m){return m}G=this.$get_source_id();var F=(v.Rho)._scope.RhoConfig.$sources()["$[]"](this.$get_source_name());I=F.partition;J=(function(){if((O=this.$is_schema_source())!==false&&O!==m){return this.$get_schema_table_name()}else{return"object_values"}return m}).call(this);R=(n.Object._scope.Rho)._scope.RHO.$get_src_db(this.$get_source_name());R.$start_transaction();return(function(){try{(function(){if(H["$=="]("rollback")){if((O=K)===false||O===m){this.$raise(v.ArgumentError,"on_sync_update_error with :rollback action should provide update-rollback parameter")}return K.$each((P=function(W,U){var T=P._s||this,V;if(W==null){W=m}if(U==null){U=m}return U["$[]"]("attributes").$each((V=function(Z,Y){var X=V._s||this;if(Z==null){Z=m}if(Y==null){Y=m}return X.$_insert_or_update_attr(R,X.$is_schema_source(),J,G,W,Z,Y)},V._s=T,V))},P._s=this,P))}else{return Q.$each((M=function(W,V){var U=M._s||this,T;if(W==null){W=m}if(V==null){V=m}return V["$[]"]("attributes").$each((T=function(ad,ac){var ab=m,Z=m,X=T._s||this,aa,Y;if(ad==null){ad=m}if(ac==null){ac=m}ab=R.$select_from_table("changed_values","update_type",o({object:W,source_id:G,attrib:ad,sent:0}));if((aa=((Y=ab!==false&&ab!==m)?ab.$length()["$>"](0):Y))!==false&&aa!==m){return m}Z=(function(){if((aa=X.$is_blob_attrib(I,G,ad))!==false&&aa!==m){return"blob.file"}else{return""}return m}).call(X);return R.$insert_into_table("changed_values",o({source_id:G,object:W,attrib:ad,value:ac,update_type:"update",attrib_type:Z}))},T._s=U,T))},M._s=this,M))}return m}).call(this);R.$commit()}catch(S){if(v.Exception["$==="](S)){L=S;this.$puts("on_sync_update_error Exception: "["$+"](L.$inspect()));R.$rollback();this.$raise()}else{throw S}}}).call(this)}else{return m}};E.$push_changes=function(){var F=m,G=m,H;if((H=this.$is_sync_source())===false||H===m){return m}F=this.$get_source_id();G=(n.Object._scope.Rho)._scope.RHO.$get_src_db(this.$get_source_name());return G.$insert_into_table("changed_values",o({update_type:"push_changes",source_id:F}))};E.$on_sync_create_error=function(N,G){var M=m,H=m,F=m,O=m,I=m,L,K,J;if((L=true)!==false&&L!==m){if((L=((K=G["$=="]("delete")),K!==false&&K!==m?K:G["$=="]("recreate")))===false||L===m){this.$raise(v.ArgumentError,"on_sync_create_error action should be :delete or :recreate")}if((L=this.$is_sync_source())===false||L===m){return m}M=N;if((L=N["$is_a?"](v.Hash))!==false&&L!==m){M=N.$keys()}else{if((L=(K=N["$is_a?"](v.Array),(K===m||K===false)))!==false&&L!==m){M=[N]}}this.$puts("ar_objs : "+(M));H=(function(){if((L=this.$is_schema_source())!==false&&L!==m){return this.$get_schema_table_name()}else{return"object_values"}return m}).call(this);F=this.$get_source_id();O=(n.Object._scope.Rho)._scope.RHO.$get_src_db(this.$get_source_name());O.$start_transaction();return(function(){try{M.$each((J=function(U){var T=m,Q=J._s||this,S,R;if(U==null){U=m}if(G["$=="]("recreate")){T=O.$select_from_table("changed_values","object",o({update_type:"delete",object:U,source_id:F}));if((S=((R=T!==false&&T!==m)?T.$length()["$>"](0):R))===false||S===m){O.$delete_from_table("changed_values",o({object:U,source_id:F}));O.$insert_into_table("changed_values",o({update_type:"create",attrib:"object",source_id:F,object:U}));return m}}O.$delete_from_table("changed_values",o({object:U,source_id:F}));if((S=Q.$is_schema_source())!==false&&S!==m){return O.$delete_from_table(H,o({object:U}))}else{return O.$delete_from_table(H,o({object:U,source_id:F}))}},J._s=this,J));O.$commit()}catch(P){if(v.Exception["$==="](P)){I=P;this.$puts("on_create_error Exception: "["$+"](I.$inspect()));O.$rollback();this.$raise()}else{throw P}}}).call(this)}else{return m}};E.$delete_all=function(M){var R=m,H=m,I=m,Q=m,P=m,G=m,S=m,F=m,K=m,O,N,L,J;M=j.call(arguments,0);R=(n.Object._scope.Rho)._scope.RHO.$get_src_db(this.$get_source_name());H=(function(){if((O=this.$is_schema_source())!==false&&O!==m){return this.$get_schema_table_name()}else{return"object_values"}return m}).call(this);I="AND";if((O=(N=((N=M!==false&&M!==m)?M["$[]"](0):N),N!==false&&N!==m?M["$[]"](0)["$[]"]("op"):N))!==false&&O!==m){I=M["$[]"](0)["$[]"]("op").$upcase()}if((O=(N=((N=M!==false&&M!==m)?M["$[]"](0):N),N!==false&&N!==m?M["$[]"](0)["$[]"]("conditions"):N))!==false&&O!==m){Q=M["$[]"](0)["$[]"]("conditions")}return(function(){try{R.$start_transaction();(function(){if((O=this.$is_schema_source())!==false&&O!==m){P=[];G="";this.$convertConditionToStatement(Q,I,G,P);if((O=this.$is_sync_source())!==false&&O!==m){S="SELECT object FROM "+(H);if(G.$length()["$>"](0)){S["$<<"](" WHERE "["$+"](G))}F=R.$execute_sql(S,P);return F.$each((L=function(X){var W=m,V=m,U=L._s||this,Y;if(X==null){X=m}R.$delete_from_table("changed_values",o({object:X["$[]"]("object"),source_id:U.$get_source_id(),sent:0}));W=R.$select_from_table(H,"*",o({object:X["$[]"]("object")}));W["$[]"](0).$each((Y=function(ab,aa){var Z=Y._s||this;if(ab==null){ab=m}if(aa==null){aa=m}if(ab["$=="]("object")){return m}return R.$insert_into_table("changed_values",o({source_id:Z.$get_source_id(),object:X["$[]"]("object"),attrib:ab,value:aa,update_type:"delete"}))},Y._s=U,Y));S="DELETE FROM "+(H)+" WHERE object=?";V=[X["$[]"]("object")];return R.$execute_sql(S,V)},L._s=this,L))}else{S="DELETE FROM "+(H);if(G.$length()["$>"](0)){S["$<<"](" WHERE "["$+"](G))}return R.$execute_sql(S,P)}}else{F=[];if((O=(N=Q,(N===m||N===false)))!==false&&O!==m){if((O=this.$is_sync_source())!==false&&O!==m){F=R.$execute_sql("SELECT DISTINCT(object) FROM "+(H)+" WHERE source_id=?",[this.$get_source_id()])}else{R.$delete_from_table(H,o({source_id:this.$get_source_id()}))}}else{if((O=Q["$is_a?"](v.Hash))!==false&&O!==m){F=this.$find_objects(Q,I,m,0,m)}else{F=this.$find_objects_ex(Q,I,m,0,m)}}return F.$each((J=function(Y){var X=m,V=m,U=J._s||this,W,Z;if(Y==null){Y=m}if((W=U.$is_sync_source())!==false&&W!==m){R.$delete_from_table("changed_values",o({object:Y["$[]"]("object"),source_id:U.$get_source_id(),sent:0}));X=R.$select_from_table(H,"*",o({object:Y["$[]"]("object"),source_id:U.$get_source_id()}));X.$each((Z=function(ab){var aa=Z._s||this;if(ab==null){ab=m}return R.$insert_into_table("changed_values",o({source_id:aa.$get_source_id(),object:Y["$[]"]("object"),attrib:ab["$[]"]("attrib"),value:ab["$[]"]("value"),update_type:"delete"}))},Z._s=U,Z))}S="DELETE FROM "+(H)+" WHERE \n";S["$<<"]("object=? AND source_id=?");V=[];V["$<<"](Y["$[]"]("object"));V["$<<"](U.$get_source_id());return R.$execute_sql(S,V)},J._s=this,J))}return m}).call(this);R.$commit()}catch(T){if(v.Exception["$==="](T)){K=T;this.$puts("delete_all Exception: "["$+"](K.$inspect()));R.$rollback();this.$raise()}else{throw T}}}).call(this)};return E.$create=function(F){var G=m;G=this.$new(F);G.$create();return G}}).call(C.$singleton_class());D.$can_modify=function(){var F=m,I=m,E=m,H,G;F=(n.Object._scope.Rho)._scope.RHO.$get_src_db(this.$get_inst_source_name());I=this.$object();E=F.$execute_sql("SELECT object FROM changed_values WHERE source_id=? and object=? and sent>1 LIMIT 1 OFFSET 0",[this.$get_inst_source_id().$to_i(),I]);return(H=((G=E!==false&&E!==m)?E.$length()["$>"](0):G),(H===m||H===false))};C["$changed?"]=function(){var F=m,E=m,G;F=(n.Object._scope.Rho)._scope.RHO.$get_src_db(this.$get_source_name());E=F.$execute_sql("SELECT object FROM changed_values WHERE source_id=? LIMIT 1 OFFSET 0",[this.$get_source_id().$to_i()]);return((G=E!==false&&E!==m)?E.$length()["$>"](0):G)};D["$changed?"]=function(){var F=m,H=m,E=m,G;F=(n.Object._scope.Rho)._scope.RHO.$get_src_db(this.$get_inst_source_name());H=this.$object();E=F.$execute_sql("SELECT object FROM changed_values WHERE source_id=?  and object=? LIMIT 1 OFFSET 0",[this.$get_inst_source_id().$to_i(),H]);return((G=E!==false&&E!==m)?E.$length()["$>"](0):G)};D.$destroy=function(){var F=m,I=m,O=m,H=m,L=m,P=m,J=m,M,K,G,E;F=this.$object();I="delete";if(F!==false&&F!==m){O=(n.Object._scope.Rho)._scope.RHO.$get_src_db(this.$get_inst_source_name());try{H=(this.$is_inst_schema_source())?this.$get_inst_schema_table_name():"object_values";O.$start_transaction();L=m;if(this.$is_inst_schema_source()){L=O.$select_from_table(H,"*",o({object:F}));O.$delete_from_table(H,o({object:F}))}else{L=O.$select_from_table(H,"*",o({object:F,source_id:this.$get_inst_source_id()}));O.$delete_from_table(H,o({object:F,source_id:this.$get_inst_source_id()}))}P=(function(){if((M=this.$is_inst_sync_source())!==false&&M!==m){return O.$select_from_table("changed_values","update_type",o({object:F,update_type:"create",sent:0}))}else{return m}return m}).call(this);if((M=((K=P!==false&&P!==m)?P.$length()["$>"](0):K))!==false&&M!==m){I=m}if((M=this.$is_inst_sync_source())!==false&&M!==m){O.$delete_from_table("changed_values",o({object:F,source_id:this.$get_inst_source_id(),sent:0}))}if((M=(K=(K=(K=this.$is_inst_sync_source(),K!==false&&K!==m?I:K),K!==false&&K!==m?L:K),K!==false&&K!==m?L.$length()["$>"](0):K))!==false&&M!==m){if(this.$is_inst_schema_source()){L["$[]"](0).$each((G=function(S,R){var Q=G._s||this;if(S==null){S=m}if(R==null){R=m}if(S["$=="]("object")){return m}return O.$insert_into_table("changed_values",o({source_id:Q.$get_inst_source_id(),object:F,attrib:S,value:R,update_type:I}))},G._s=this,G))}else{L["$[]"](0).$each((E=function(S,R){var Q=E._s||this;if(S==null){S=m}return O.$insert_into_table("changed_values",o({source_id:Q.$get_inst_source_id(),object:F,attrib:S,value:R,update_type:I}))},E._s=this,E))}}O.$commit()}catch(N){if(v.Exception["$==="](N)){J=N;this.$puts("destroy Exception: "["$+"](J.$inspect()));O.$rollback();this.$raise()}else{throw N}}}return true};D.$create=function(){var E=m,H=m,F=m,I=m,L,M=m,J=m,K,G;E=this.$get_inst_source_id();H=this.$object();F=this.$get_inst_source_name();I=(this.$is_inst_schema_source())?this.$get_inst_schema_table_name():"object_values";L=this.$is_inst_schema_source();M=(n.Object._scope.Rho)._scope.RHO.$get_src_db(F);return(function(){try{M.$start_transaction();(function(){if((K=this.$is_inst_sync_source())!==false&&K!==m){return M.$insert_into_table("changed_values",o({update_type:"create",attrib:"object",source_id:E,object:H}))}else{return m}return m}).call(this);(function(){if(L){return M.$insert_into_table(I,this.$vars(),o({source_id:true}))}else{return this.$vars().$each((G=function(P,S){var R=m,T=m,O=G._s||this,Q;if(P==null){P=m}if(S==null){S=m}R=P.$to_s();if((Q=(n.Object._scope.Rhom)._scope.RhomObject["$method_name_reserved?"](R))!==false&&Q!==m){return m}T=S.$to_s();return M.$insert_into_table(I,o({source_id:E,object:H,attrib:R,value:T}))},G._s=this,G))}return m}).call(this);M.$commit()}catch(N){if(v.Exception["$==="](N)){J=N;this.$puts("create Exception: "["$+"](J.$inspect()));M.$rollback();this.$raise()}else{throw N}}}).call(this)};D.$save=function(){var K=m,H=m,T=m,L=m,M=m,R=m,G=m,I=m,O=m,N=m,F=m,U=m,Q,P,J;K=this.$object();H=this.$get_inst_source_id();T=(n.Object._scope.Rho)._scope.RHO.$get_src_db(this.$get_inst_source_name());var E=(v.Rho)._scope.RhoConfig.$sources()["$[]"](this.$get_inst_source_name());L=E.partition;M=(this.$is_inst_schema_source())?this.$get_inst_schema_table_name():"object_values";R=this.$is_inst_schema_source();G=false;try{T.$lock_db();if(R!==false&&R!==m){I=T.$execute_sql("SELECT object FROM "+(M)+" WHERE object=? LIMIT 1 OFFSET 0",[K])}else{I=T.$execute_sql("SELECT object FROM "+(M)+" WHERE object=? AND source_id=? LIMIT 1 OFFSET 0",[K,H])}if((Q=((P=I!==false&&I!==m)?I.$length()["$>"](0):P))===false||Q===m){G=true;this.$create()}T.$unlock_db()}catch(S){if(v.Exception["$==="](S)){O=S;this.$puts("save Exception: "["$+"](O.$inspect()));T.$unlock_db();this.$raise()}else{throw S}}if(G!==false&&G!==m){return m}try{T.$start_transaction();N="update";F=true;U=m;if((Q=this.$is_inst_sync_source())!==false&&Q!==m){U=T.$select_from_table("changed_values","update_type",o({object:K,source_id:H,sent:0}));if((Q=((P=U!==false&&U!==m)?U.$length()["$>"](0):P))!==false&&Q!==m){N=U["$[]"](0)["$[]"]("update_type")}F=N["$=="]("create")}this.$vars().$each((J=function(W,ad){var ae=m,V=m,Y=m,X=m,ac=m,ab=m,af=J._s||this,aa,Z;if(W==null){W=m}if(ad==null){ad=m}ae=W.$to_s();if((aa=(n.Object._scope.Rhom)._scope.RhomObject["$method_name_reserved?"](ae))!==false&&aa!==m){return m}V=ad.$to_s();Y=o({source_id:H,object:K,attrib:ae,value:V,update_type:N});Y=(function(){if((aa=af.constructor.$is_blob_attrib(L,H,ae))!==false&&aa!==m){return Y["$merge!"](o({attrib_type:"blob.file"}))}else{return Y}return m}).call(af);X=m;if(R!==false&&R!==m){X=T.$select_from_table(M,ae,o({object:K}))}else{X=T.$select_from_table(M,"value",o({object:K,attrib:ae,source_id:H}))}if((aa=((Z=X!==false&&X!==m)?X.$length()["$>"](0):Z))!==false&&aa!==m){ac=false;ab=(function(){if(R!==false&&R!==m){return X["$[]"](0)["$[]"](ae)}else{return X["$[]"](0)["$[]"]("value")}return m}).call(af);ac=(aa=ab["$=="](V),(aa===m||aa===false));if((aa=(Z=(Z=((Z=ac!==false&&ac!==m)?V:Z),Z!==false&&Z!==m?ab["$nil?"]():Z),Z!==false&&Z!==m?V.$to_s().$length()["$=="](0):Z))!==false&&aa!==m){ac=false}if((aa=(Z=(Z=((Z=ac!==false&&ac!==m)?ab:Z),Z!==false&&Z!==m?V["$nil?"]():Z),Z!==false&&Z!==m?ab.$to_s().$length()["$=="](0):Z))!==false&&aa!==m){ac=false}if(ac!==false&&ac!==m){if((aa=F)===false||aa===m){U=T.$select_from_table("changed_values","update_type",o({object:K,attrib:ae,source_id:H,sent:0}));if((aa=((Z=U!==false&&U!==m)?U.$length()["$>"](0):Z))!==false&&aa!==m){T.$update_into_table("changed_values",o({value:V}),o({object:K,attrib:ae,source_id:H}))}else{T.$insert_into_table("changed_values",Y)}}if(R!==false&&R!==m){return T.$update_into_table(M,h(ae,V),o({object:K}))}else{return T.$update_into_table(M,o({value:V}),o({object:K,attrib:ae,source_id:H}))}}else{return m}}else{if((aa=F)===false||aa===m){T.$insert_into_table("changed_values",Y)}Y.$delete("update_type");Y.$delete("attrib_type");if(R!==false&&R!==m){return T.$insert_into_table(M,h(ae,V,"object",K))}else{return T.$insert_into_table(M,Y)}}},J._s=this,J));T.$commit()}catch(S){if(v.Exception["$==="](S)){O=S;this.$puts("save Exception: "["$+"](O.$inspect()));T.$rollback();this.$raise()}else{throw S}}return true};C.$_insert_or_update_attr=function(M,I,H,E,F,G,J){var N=m,L,K;if(I!==false&&I!==m){N=M.$select_from_table(H,"object",o({object:F}));if((L=((K=N!==false&&N!==m)?N.$length()["$>"](0):K))!==false&&L!==m){return M.$update_into_table(H,h(G,J),o({object:F}))}else{return M.$insert_into_table(H,h("object",F,G,J))}}else{N=M.$select_from_table(H,"source_id",o({object:F,attrib:G,source_id:E}));if((L=((K=N!==false&&N!==m)?N.$length()["$>"](0):K))!==false&&L!==m){return M.$update_into_table(H,o({value:J}),o({object:F,attrib:G,source_id:E}))}else{return M.$insert_into_table(H,o({source_id:E,object:F,attrib:G,value:J}))}}};D.$update_attributes=function(P){var I=m,L=m,G=m,R=m,J=m,K=m,F=m,S=m,M=m,O,N,H;this.$check_freezing_model(P);I=this.$object();L="update";G=this.$get_inst_source_id();R=(n.Object._scope.Rho)._scope.RHO.$get_src_db(this.$get_inst_source_name());var E=(v.Rho)._scope.RhoConfig.$sources()["$[]"](this.$get_inst_source_name());J=E.partition;K=(this.$is_inst_schema_source())?this.$get_inst_schema_table_name():"object_values";try{R.$start_transaction();F=true;if((O=this.$is_inst_sync_source())!==false&&O!==m){S=R.$select_from_table("changed_values","update_type",o({object:I,source_id:G,sent:0}));if((O=((N=S!==false&&S!==m)?S.$length()["$>"](0):N))!==false&&O!==m){L=S["$[]"](0)["$[]"]("update_type")}F=L["$=="]("create")}P.$each((H=function(W,U){var X=m,aa=m,T=m,V=m,ab=H._s||this,Z,Y;if(W==null){W=m}if(U==null){U=m}W=W.$to_s().$gsub(/@/,"");if((Z=(n.Object._scope.Rhom)._scope.RhomObject["$method_name_reserved?"](W))!==false&&Z!==m){return m}X=U.$to_s();aa=false;if((Z=(n.Object._scope.Rhom)._scope.RhomObject["$method_name_reserved?"](W))===false||Z===m){T=ab.$vars()["$[]"](W)}aa=(Z=T["$=="](X),(Z===m||Z===false));if((Z=(Y=(Y=((Y=aa!==false&&aa!==m)?X:Y),Y!==false&&Y!==m?T["$nil?"]():Y),Y!==false&&Y!==m?X.$to_s().$length()["$=="](0):Y))!==false&&Z!==m){aa=false}if((Z=(Y=(Y=((Y=aa!==false&&aa!==m)?T:Y),Y!==false&&Y!==m?X["$nil?"]():Y),Y!==false&&Y!==m?T.$to_s().$length()["$=="](0):Y))!==false&&Z!==m){aa=false}if(aa!==false&&aa!==m){ab.constructor.$_insert_or_update_attr(R,ab.$is_inst_schema_source(),K,G,I,W,X);if((Z=F)===false||Z===m){if((Z=((Y=S!==false&&S!==m)?S.$length()["$>"](0):Y))!==false&&Z!==m){R.$delete_from_table("changed_values",o({object:I,attrib:W,source_id:G,sent:0}))}V=(function(){if((Z=ab.$is_blob_attrib(J,G,W))!==false&&Z!==m){return"blob.file"}else{return""}return m}).call(ab);R.$insert_into_table("changed_values",o({source_id:G,object:I,attrib:W,value:X,update_type:L,attrib_type:V}))}return ab.$vars()["$[]="](W.$to_sym(),X)}else{return m}},H._s=this,H));R.$commit()}catch(Q){if(v.Exception["$==="](Q)){M=Q;this.$puts("update_attributes Exception: "["$+"](M.$inspect()));R.$rollback();this.$raise()}else{throw Q}}return true};D.$get_inst_source_name=function(){return this.$class().$name().$to_s()};D.$is_blob_attrib=function(G,E,F){return d.Database.SQLite3.isBlobAttr(G,E.$to_i(),F)};D.$get_inst_source_id=function(){var E=(v.Rho)._scope.RhoConfig.$sources()["$[]"](this.$get_inst_source_name());return E.source_id};D.$is_inst_sync_source=function(){var E=(v.Rho)._scope.RhoConfig.$sources()["$[]"](this.$get_inst_source_name());return E.sync_type!=="none"};D.$is_inst_schema_source=function(){var E=(v.Rho)._scope.RhoConfig.$sources()["$[]"](this.$get_inst_source_name());return E.hasOwnProperty("schema")};D.$get_inst_schema_table_name=function(){return this.$get_inst_source_name()};return D.$inst_strip_braces=function(E){if(E==null){E=m}if(E!==false&&E!==m){return E.$gsub(/\{/,"").$gsub(/\}/,"")}else{return m}}},z._s=this,z)))}};return m})(q,null);q._sdonate(["$any_model_changed?"])})(p)})();(function(){var i=m,q=m,n,o=Opal,r=o.top,l=o,m=o.nil,h=o.breaker,j=o.slice,k=o.module,g=o.klass,p=o.hash2;l.RHO_RB_EXT=".rb";l.RHO_APPS_DIR="";(function(s){function v(){}v=k(s,"Rho",v);var u=v.prototype,t=v._scope;(function(x,A){function w(){}w=g(x,A,"RHO",w);w._sdonate(["$get_src_db"]);var z=w.prototype,y=w._scope;w.$get_src_db=function(D){var E=Opal.Rho._scope.RhoConfig.$sources().map[D];var B=m;var C="user";if(E!==undefined){if(E.partition!==undefined){C=E.partition}B=d.ORMHelper.dbConnection(C)}return B};return m})(v,null);(function(x,A){function w(){}w=g(x,A,"RhoConfig",w);var z=w.prototype,y=w._scope;return(function(){var B=w._scope,C=w;(Opal.cvars["@@g_base_temp_id"]=m);C.$generate_id=function(){var E,D;if((E=((D=Opal.cvars["@@g_base_temp_id"])==null?m:D))===false||E===m){(Opal.cvars["@@g_base_temp_id"]=B.Time.$now().$to_f()["$-"](B.Time.$mktime(2009,1,1,0,0,0,0).$to_f())["$*"]((10)["$**"](6)))}(Opal.cvars["@@g_base_temp_id"]=((E=Opal.cvars["@@g_base_temp_id"])==null?m:E)["$+"](1));return((E=Opal.cvars["@@g_base_temp_id"])==null?m:E)};(Opal.cvars["@@sources"]=m);return C.$sources=function(){var D=m,F,E;if((F=((E=Opal.cvars["@@sources"])==null?m:E))===false||F===m){(Opal.cvars["@@sources"]=p({}))}return((F=Opal.cvars["@@sources"])==null?m:F)}}).call(w.$singleton_class())})(v,null)})(r)})()})()})(Rho.jQuery,Rho,Rho.util);